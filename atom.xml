<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[永久记录]]></title>
  <link href="https://smartdigg.github.io/atom.xml" rel="self"/>
  <link href="https://smartdigg.github.io/"/>
  <updated>2026-02-01T23:40:47+08:00</updated>
  <id>https://smartdigg.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im/">MWeb</generator>
  
  <entry>
    <title type="html"><![CDATA[自建个人文档版本管理系统 Gogs]]></title>
    <link href="https://smartdigg.github.io/self-hosted-file-version-control-system-gogs.html"/>
    <updated>2025-12-24T23:33:18+08:00</updated>
    <id>https://smartdigg.github.io/self-hosted-file-version-control-system-gogs.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E8%A3%85%E5%87%86%E5%A4%87">安装准备</a></li>
<li><a href="#%E5%AE%89%E8%A3%85gogs">安装 Gogs</a></li>
<li><a href="#%E5%8D%87%E7%BA%A7gogs">升级 Gogs</a></li>
<li><a href="#%E8%BF%9B%E9%98%B6%E8%AE%BE%E7%BD%AE">进阶设置</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3">修改默认端口</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a>
<ul>
<li><a href="#nginx">NGINX</a></li>
<li><a href="#caddy">Caddy</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">开机启动</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">数据迁移</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>Gogs 官方号称是一个无痛的自托管 Git 服务，相较后继者 Gitea 更简单易懂，非常适合个人管理文档版本。</p>
<h2><a id="%E5%AE%89%E8%A3%85%E5%87%86%E5%A4%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装准备</h2>
<p>确保 macOS 已安装 git：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew update
$ brew install git
</code></pre>
<h2><a id="%E5%AE%89%E8%A3%85gogs" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 Gogs</h2>
<p>可以到 Gogs 官网直接下载<a href="https://gogs.io/docs/installation/install_from_binary">https://gogs.io/docs/installation/install_from_binary</a>，例如 macOS arm64 最新版本是 <code>gogs_0.13.3_ darwin_arm64.zip</code>。解压缩后文件夹路径为 <code>/Users/username/path-to-gogs/gogs</code>，进入该目录并启动gogs服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd /Users/username/path-to-gogs/gogs
$ ./gogs web
</code></pre>
<p>浏览器打开安装页面 <a href="http://localhost:3000">http://localhost:3000</a> 进行下一步安装。</p>
<p>安装界面：<br />
<img src="media/17665903986851/gogs2.webp" alt="gogs2" /></p>
<p>个人使用可以尽量简化：</p>
<ul>
<li>数据库类型：选择 <code>SQLite3</code></li>
<li>数据库文件路径：<code>data/gogs.db</code></li>
<li>仓库根目录：自定义，例如 <code>gogs-repositories</code></li>
<li>以此用户运行： <code>macOS</code> 用户名</li>
<li>SSH 服务端口：留空</li>
<li>HTTP 端口：3000</li>
<li>应用程序 URL：<code>http://localhost:3000</code></li>
<li>日志路径：<code>log</code></li>
</ul>
<p>安装 Gogs 成功后，第一位注册用户默认是管理员。</p>
<p>新建仓库：<br />
<img src="media/17665903986851/gogs-new-repo.webp" alt="gogs-new-repo" /></p>
<p>在 Finder 中新建文件夹作为仓库，进入该文件夹并执行如下命令：</p>
<pre class="line-numbers"><code class="language-plain_text">touch README.md
git init
git add README.md
git commit -m &quot;first commit&quot;
git remote add origin http://localhost:3000/username/test-repository.git
git push -u origin main
</code></pre>
<h2><a id="%E5%8D%87%E7%BA%A7gogs" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>升级 Gogs</h2>
<p>找到 <code>gogs</code> 所在文件夹，并重命名 为<code>gogs_old</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">$ mv gogs gogs_old
</code></pre>
<p>到官网下载 Gogs 最新版本，解压后获得一个新的 <code>gogs</code> 文件夹。</p>
<p>将 <code>gogs_old</code> 下三个文件夹 <code>custom</code>，<code>data</code>以及 <code>log </code>复制到新的 <code>gogs</code> 文件夹即可：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cp -R gogs_old/{custom,data,log} gogs
</code></pre>
<p>重新启动 <code>gogs</code> 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd gogs
$ ./gogs web
</code></pre>
<h2><a id="%E8%BF%9B%E9%98%B6%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>进阶设置</h2>
<h3><a id="%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>修改默认端口</h3>
<p>Gogs 默认端口为<code>3000</code>，初次启动可改变端口，例如 <code>3001</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">$ ./gogs web -port 3001
</code></pre>
<h3><a id="%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>反向代理</h3>
<h4><a id="nginx" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>NGINX</h4>
<pre class="line-numbers"><code class="language-plain_text">server {
    listen 80;
    server_name git.crystalnetwork.us;

    location / {
        proxy_pass http://localhost:3000;
    }
}
</code></pre>
<h4><a id="caddy" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Caddy</h4>
<pre class="line-numbers"><code class="language-plain_text">git.example.com {
    proxy / http://localhost:3000
}
</code></pre>
<h3><a id="%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开机启动</h3>
<p>创建 Launch Agent 文件： <code>~/Library/LaunchAgents/io.gogs.web.plist </code>，内容如下：</p>
<pre class="line-numbers"><code class="language-plain_text">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
  &lt;dict&gt;
    &lt;key&gt;KeepAlive&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;io.gogs.web&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
          &lt;string&gt;sh&lt;/string&gt;
          &lt;string&gt;-c&lt;/string&gt;
          &lt;string&gt;cd /Users/username/path-to-gogs/gogs; ./gogs web&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;WorkingDirectory&lt;/key&gt;
    &lt;string&gt;/Users/username/path-to-gogs/gogs/&lt;/string&gt;
    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;
  &lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>加载 daemon 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl load -w ~/Library/LaunchAgents/io.gogs.server.plist 
</code></pre>
<p>启动 <code>gogs</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl start io.gogs.web
</code></pre>
<p>停止 <code>gogs</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl stop io.gogs.web
</code></pre>
<p>重启 <code>gogs</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl restart io.gogs.web
</code></pre>
<h3><a id="%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>数据迁移</h3>
<p>复制 <code>gogs</code> 以及 <code>gogs-repositories</code> 文件夹到新电脑，根据实际情况修改 <code>custom/conf/app.ini</code>。之后正常启动即可。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>Gogs 官网 <a href="https://gogs.io/">https://gogs.io</a></li>
<li>Gogs 帮助文档faqs <a href="https://gogs.io/docs/intro/faqs">https://gogs.io/docs/intro/faqs</a></li>
<li>Gogs issues <a href="https://github.com/gogs/gogs/issues/7322">https://github.com/gogs/gogs/issues/7322</a></li>
<li>macOS 搭建 Gitea 私有 Git 服务器教程 <a href="https://blog.csdn.net/m0_55316234/article/details/150212224">https://blog.csdn.net/m0_55316234/article/details/150212224</a></li>
<li>Start the runner with LaunchDaemon(macOS) <a href="https://docs.gitea.com/usage/actions/act-runner#start-the-runner-with-launchdaemonmacos">https://docs.gitea.com/usage/actions/act-runner#start-the-runner-with-launchdaemonmacos</a></li>
<li>如何使用Gogs搭建自己的git服务器 <a href="https://www.cnblogs.com/zhaotianff/p/17887191.html">https://www.cnblogs.com/zhaotianff/p/17887191.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 coredns 自建 DoH 服务]]></title>
    <link href="https://smartdigg.github.io/self-hosted-doh-server-by-coredns.html"/>
    <updated>2025-10-05T11:34:20+08:00</updated>
    <id>https://smartdigg.github.io/self-hosted-doh-server-by-coredns.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E8%A3%85coredns">安装 coredns</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AEcaddy%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">设置 caddy 反向代理</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8curl%E6%A3%80%E6%9F%A5-doh%E5%8F%AF%E7%94%A8%E6%80%A7">使用 Curl 检查 DoH 可用性</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>目标：搭建快速 DoH 服务器，替代 AdGuardHome 以及 Nginx，参考<a href="configure-DNS-over-HTTPS-on-VPS.html">VPS 搭建 DNS-over-HTTPS 服务器</a>。</p>
<h2><a id="%E5%AE%89%E8%A3%85coredns" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 coredns</h2>
<p>新建 coredns 配置文件：</p>
<pre class="line-numbers"><code class="language-plain_text"># vi /etc/coredns/Corefile

https://.:444 {
    bind 127.0.0.1
    forward . 1.1.1.1 1.0.0.1
    log
    errors
    cache
}
</code></pre>
<p>使用 hostNetwork 模式启动服务，监听444端口：</p>
<pre class="line-numbers"><code class="language-plain_text"># docker run -d --restart unless-stopped --network host --name coredns \
  -v /etc/coredns:/etc/coredns \
  coredns/coredns \
  -conf /etc/coredns/Corefile
</code></pre>
<h2><a id="%E8%AE%BE%E7%BD%AEcaddy%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>设置 caddy 反向代理</h2>
<p>假设 DoH 服务器域名为<code>dns.example.com</code>。自行导入域名<code>example.com</code>的两个证书，放置于目录<code>/etc/letsencrypt/live/example.com/</code>（目录需自行创建）。</p>
<p>编辑 caddy 配置文件：</p>
<pre class="line-numbers"><code class="language-plain_text"># vi  /etc/caddy/Caddyfile

dns.example.com {
	tls /etc/letsencrypt/live/example.com/OriginCertificate.pem  /etc/letsencrypt/live/example.com/PrivateKey.pem

	handle /dns-query {
      reverse_proxy 127.0.0.1:444
    } 
}
</code></pre>
<p>排查 coredns 错误：</p>
<pre class="line-numbers"><code class="language-plain_text"># docker logs coredns
</code></pre>
<p>防火墙放行444端口：</p>
<pre class="line-numbers"><code class="language-plain_text"># ufw allow 444
</code></pre>
<h2><a id="%E4%BD%BF%E7%94%A8curl%E6%A3%80%E6%9F%A5-doh%E5%8F%AF%E7%94%A8%E6%80%A7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用 Curl 检查 DoH 可用性</h2>
<pre class="line-numbers"><code class="language-plain_text">$ curl --doh-url https://dns.example.com/dns-query https://www.ifeng.com
</code></pre>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>自建DoH服务 <a href="https://wbuntu.com/deploy-a-doh-service/">https://wbuntu.com/deploy-a-doh-service/</a></li>
<li>Recommended DoH server implementation <a href="https://github.com/DNSCrypt/doh-server">https://github.com/DNSCrypt/doh-server</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS 安全使用习惯]]></title>
    <link href="https://smartdigg.github.io/macos-security-practices.html"/>
    <updated>2024-03-27T11:12:50+08:00</updated>
    <id>https://smartdigg.github.io/macos-security-practices.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%90%AF%E7%94%A8filevault">启用 FileVault</a></li>
<li><a href="#%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6">备份文件</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5mac%E9%9A%90%E7%A7%81%E8%AE%BE%E7%BD%AE">检查 Mac 隐私设置</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E6%9F%A5%E6%89%BE%E6%88%91%E7%9A%84mac">设置查找我的 Mac</a></li>
<li><a href="#%E5%BC%80%E5%90%AF2fa">开启 2FA</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E8%BE%93%E5%85%A5%E6%B3%95">使用安全输入法</a></li>
<li><a href="#%E6%B5%81%E9%87%8F%E5%8A%A0%E5%AF%86">流量加密</a></li>
<li><a href="#%E9%98%B2%E7%81%AB%E5%A2%99">防火墙</a></li>
<li><a href="#%E8%BF%9C%E7%A6%BB%E7%A0%B4%E8%A7%A3%E7%89%88%E4%BB%A5%E5%8F%8A%E4%B8%AD%E5%9B%BD%E5%A4%A7%E9%99%86%E8%BD%AF%E4%BB%B6">远离破解版以及中国大陆软件</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E6%B5%8F%E8%A7%88%E5%99%A8">使用安全浏览器</a></li>
<li><a href="#%E4%B8%8B%E8%BD%BD%E9%AA%8C%E8%AF%81">下载验证</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E5%90%AF%E7%94%A8filevault" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>启用 FileVault</h2>
<p>打开<code>System Settings</code>，单击<code>Privacy &amp; Security</code>，选择<code>FileVault</code>选项卡。单击开启 FileVault，然后按照屏幕说明操作。</p>
<h2><a id="%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>备份文件</h2>
<p>使用 Apple 的<code>Time Machine</code>功能可以备份文件。</p>
<ul>
<li>连接一个外部硬盘驱动器，该硬盘驱动器应不小于您的 Mac 驱动器容量，且未存储其他文件</li>
<li>在<code>System Settings</code>中，单击<code>General</code>，打开<code>Time Machine</code>应用程序</li>
<li>单击选择备份硬盘，选择硬盘名称，然后单击<code>Setup Disk</code></li>
<li>勾选<code>Auto Backup</code>，这样便无需记着手动备份</li>
</ul>
<h2><a id="%E6%A3%80%E6%9F%A5mac%E9%9A%90%E7%A7%81%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>检查 Mac 隐私设置</h2>
<ul>
<li>打开<code>System Settings</code>，转到<code>Privacy &amp; Security</code></li>
<li>选择<code>Privacy</code>选项卡</li>
<li>仔细检查每项权限，取消选中任何觉得不必要的权限（如果改变主意，随时可以恢复权限）</li>
</ul>
<h2><a id="%E8%AE%BE%E7%BD%AE%E6%9F%A5%E6%89%BE%E6%88%91%E7%9A%84mac" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>设置查找我的 Mac</h2>
<ul>
<li>首先，开启隐私设置中的<code>Location Services</code>，在可以使用您的位置的应用程序列表中选择<code>查找我的 Mac</code></li>
<li>随后，单击 Apple 菜单图标，选择<code>System Settings</code>，然后选择<code>Privacy &amp; Security</code>，再选择<code>Location Services</code></li>
<li>单击挂锁图标并输入密码</li>
<li>选择<code>System Services</code>，选择<code>Find My Mac</code>，锁定挂锁以阻止进一步的更改</li>
</ul>
<h2><a id="%E5%BC%80%E5%90%AF2fa" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开启 2FA</h2>
<ul>
<li>转到<code>System Settings</code>，选择<code>Apple ID</code>，然后选择<code>Password &amp; Security</code></li>
<li>随后，转到<code>Two-Factor Authentication</code>，单击<code>Turn On</code></li>
<li>之后系统会要求您输入电话号码，以接收双因素身份验证代码</li>
</ul>
<h2><a id="%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E8%BE%93%E5%85%A5%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用安全输入法</h2>
<p>建议安装 Rime/Squirrel，参考<a href="macos-install-rime.html">macOS安装Rime输入法</a>，远离所有国产输入法。</p>
<h2><a id="%E6%B5%81%E9%87%8F%E5%8A%A0%E5%AF%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>流量加密</h2>
<p>使用 DNS-over-HTTPS，参考<a href="configure-DNS-over-HTTPS-for-macOS.html">macOS 配置 DNS-over-HTTPS</a>或<a href="simplified-version-of-DNS-over-HTTPS-for-macOS-by-SmartDNS.html">macOS 配置 DNS-over-HTTPS SmartDNS 简化版</a>。</p>
<h2><a id="%E9%98%B2%E7%81%AB%E5%A2%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>防火墙</h2>
<p>启用内置防火墙。转到<code>System Settings</code>，打开<code>Network</code>，单击<code>Firewall</code>选项卡，单击开启防火墙。</p>
<p>Apple 的防火墙只保护传入流量，不会阻止向外发送数据。为了提高安全性，可以考虑使用提供更高级保护的第三方防火墙，例如 Little Snitch。</p>
<h2><a id="%E8%BF%9C%E7%A6%BB%E7%A0%B4%E8%A7%A3%E7%89%88%E4%BB%A5%E5%8F%8A%E4%B8%AD%E5%9B%BD%E5%A4%A7%E9%99%86%E8%BD%AF%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>远离破解版以及中国大陆软件</h2>
<p>尽量从 Mac App Store 下载软件，远离流氓软件，特别是国产软件。远离破解版，非必要软件放入虚拟机。</p>
<h2><a id="%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E6%B5%8F%E8%A7%88%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用安全浏览器</h2>
<p>参考：<a href="brave-browser-security-enhanced.html">Brave 浏览器安全配置</a>或<a href="librewolf-browser-configuration.html">LibreWolf  浏览器配置</a>。</p>
<h2><a id="%E4%B8%8B%E8%BD%BD%E9%AA%8C%E8%AF%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>下载验证</h2>
<p>验证 sha256sum，md5等等。</p>
<p>教程：<a href="mac-files-integrity-verification.html">Mac文件完整性检测</a>。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>macOS-Security-and-Privacy-Guide <a href="https://drduh.github.io/macOS-Security-and-Privacy-Guide/">https://drduh.github.io/macOS-Security-and-Privacy-Guide</a></li>
<li>Mac 安全：保障 MacBook 安全的全面指南 <a href="https://www.kaspersky.com.cn/resource-center/preemptive-safety/mac-security">https://www.kaspersky.com.cn/resource-center/preemptive-safety/mac-security</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS 配置 DNS-over-HTTPS SmartDNS 简化版]]></title>
    <link href="https://smartdigg.github.io/simplified-version-of-DNS-over-HTTPS-for-macOS-by-SmartDNS.html"/>
    <updated>2025-08-21T21:58:27+08:00</updated>
    <id>https://smartdigg.github.io/simplified-version-of-DNS-over-HTTPS-for-macOS-by-SmartDNS.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#smartdns%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE">SmartDNS 安装及配置</a></li>
<li><a href="#smartdns%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86">SmartDNS 服务管理</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>在<a href="simplified-version-of-DNS-over-HTTPS-for-macOS.html">macOS 配置 DNS-over-HTTPS 简化版</a>的基础上用 SmartDNS 替换 mosdns。可参考<a href="configure-smartdns.html">SmartDNS 配置</a>，本文采用不同的方法进行设置。</p>
<h2><a id="smartdns%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SmartDNS 安装及配置</h2>
<p>安装 SmartDNS：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew install smartdns
</code></pre>
<p>配置文件位于<code>/opt/homebrew/etc/smartdns/</code>目录。</p>
<p>同时，下载国内网站列表<a href="https://github.com/jiange1236/smartdns-rules">smartdns-rules</a>，主要是文件<code>direct-list.txt</code>以及<code>china-list.txt</code>。</p>
<p>将上述文件移动至文件夹<code>/opt/homebrew/etc/smartdns/</code>，同时在该文件夹下新建两个文件：</p>
<ul>
<li>新建<code>self-defined.conf</code>，手动添加且需要国内 DNS 解析的网站，格式如下：</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">duolingo.cn
</code></pre>
<ul>
<li>新建<code>blacklist.txt</code>，手动添加的黑名单网站，格式如下：</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">2345.com
mairuan.com
</code></pre>
<p>SmartDNS 分流的配置文件<code>smartdns.conf</code>样例：</p>
<pre class="line-numbers"><code class="language-plain_text"># 设置监听的DNS端口
bind [::]:53
bind-tcp [::]:53

tcp-idle-time 300

# 缓存大小与性能设置
cache-size 32768
prefetch-domain no
# 持久化缓存设置(可选设置)
cache-persist yes 
cache-file /opt/homebrew/etc/smartdns/smartdns-cache
serve-expired-prefetch-time 21600
serve-expired yes
serve-expired-ttl 259200
serve-expired-reply-ttl 3 
cache-checkpoint-time 86400

#禁用 SmartDNS 全局的测速设置
speed-check-mode none

force-qtype-SOA 65

#设置TTL最小值和最大值
rr-ttl 60
rr-ttl-min 0
rr-ttl-max 400

# 日志设置
log-level error
log-file /opt/homebrew/etc/smartdns/smartdns.log
log-size 5M
log-num 2

# 设置默认DNS服务器
server 127.0.0.1:5300
server-tcp 127.0.0.1:5300

# 设置国内上游DNS服务器
server-https https://dns.alidns.com/dns-query -group china -exclude-default-group
server-https https://doh.pub/dns-query -group china -exclude-default-group

# 设置域名集，包含手动添加的域名
domain-set -name direct-list -file /opt/homebrew/etc/smartdns/direct-list.txt
domain-set -name china-list -file /opt/homebrew/etc/smartdns/china-list.txt
domain-set -name self-defined -file /opt/homebrew/etc/smartdns/self-defined.conf

# 设置分流规则，国内网站使用国内DNS
nameserver /domain-set:direct-list/china
nameserver /domain-set:china-list/china
nameserver /domain-set:self-defined/china
nameserver /nstool.netease.com/china
nameserver /.cn/china

# 引入去广告配置文件
conf-file /opt/homebrew/etc/smartdns/anti-ad-for-smartdns.conf

# 引入黑名单配置文件
domain-set -name blacklist -file /opt/homebrew/etc/smartdns/blacklist.txt
address /domain-set:blacklist/#
</code></pre>
<p>部分解释：</p>
<ul>
<li>设置有<code>-exclude-default-group</code>的上游 DNS 默认不会被使用，仅当 <code>domain-rules</code>或<code>nameserver</code>配置明确指定时使用。</li>
<li><code>domain-set -name china-list -file /opt/homebrew/etc/smartdns/china-list.txt</code>，定义一个域名集<code>china-list</code>，包含的域名列表在<code> /opt/homebrew/etc/smartdns/china-list.txt</code>文件中。</li>
<li><code>nameserver /domain-set:direct-list/china</code>，设置分流规则，匹配的域名集为<code>direct-list</code>，指定使用 china 分组的 DNS 服务器解析。</li>
<li><code>address /domain-set:blacklist/#</code>，设置 IP 过滤规则，匹配的域名集为<code>blacklist</code>，使用<code>#</code>表示同时屏蔽IPV4，IPV6。可参考 SmartDNS <a href="https://pymumu.github.io/smartdns/config/ad-block/">广告屏蔽规则</a>。</li>
</ul>
<h2><a id="smartdns%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SmartDNS 服务管理</h2>
<p>启动 SmartDNS 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start smartdns
</code></pre>
<p>检查 SmartDNS 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:53
</code></pre>
<p>启动、重启与停止 SmartDNS 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start/restart/stop smartdns
</code></pre>
<p>启动检测 DNS：</p>
<ul>
<li>国内：<a href="https://d-nstool.netease.com/">https://d-nstool.netease.com</a></li>
<li>国内：<a href="https://ipleak.net/">https://ipleak.net</a></li>
</ul>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>smartdns-rules <a href="https://github.com/jiange1236/smartdns-rules">https://github.com/jiange1236/smartdns-rules</a></li>
<li>v2ray-rules-dat <a href="https://github.com/Loyalsoldier/v2ray-rules-dat/">https://github.com/Loyalsoldier/v2ray-rules-dat</a></li>
<li>SmartDNS 搭建及使用 <a href="https://blog.mxdyeah.top/post/smartdns-how-to-use">https://blog.mxdyeah.top/post/smartdns-how-to-use</a></li>
<li>广告屏蔽 <a href="https://pymumu.github.io/smartdns/config/ad-block/">https://pymumu.github.io/smartdns/config/ad-block</a></li>
<li>我有特别的 DNS 配置和使用技巧 <a href="https://blog.skk.moe/post/i-have-my-unique-dns-setup/">https://blog.skk.moe/post/i-have-my-unique-dns-setup</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何在个人电脑上部署 DeepSeek]]></title>
    <link href="https://smartdigg.github.io/how-to-deploy-deepseek-on-your-computer.html"/>
    <updated>2025-02-18T01:40:47+08:00</updated>
    <id>https://smartdigg.github.io/how-to-deploy-deepseek-on-your-computer.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%87%86%E5%A4%87">准备</a>
<ul>
<li><a href="#%E4%B8%8B%E8%BD%BDollama">下载 Ollama</a></li>
<li><a href="#%E5%AE%89%E8%A3%85ollama">安装 Ollama</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2deepseek">部署 DeepSeek</a>
<ul>
<li><a href="#%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E7%89%88%E6%9C%AC">选择合适的版本</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2deepseek-32b">部署 DeepSeek 32B</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81">配置浏览器支持</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE">参数设置</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96%E6%94%AF%E6%8C%81%E6%A8%A1%E5%9E%8B">其他支持模型</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>很多互联网公司支持使用满血版DeepSeek，与个人部署的DeepSeek的区别就在用户需要献出自己的手机号码、IP地址、设备信息、聊天记录乃至所有隐私及权利。</p>
<p><img src="media/17398140475976/tengxunyuanbao.webp" alt="tengxunyuanbao" /></p>
<h2><a id="%E5%87%86%E5%A4%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>准备</h2>
<h3><a id="%E4%B8%8B%E8%BD%BDollama" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>下载 Ollama</h3>
<p>到Ollama网页下载程序，<a href="https://ollama.com/download">https://ollama.com/download</a>。</p>
<h3><a id="%E5%AE%89%E8%A3%85ollama" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 Ollama</h3>
<p>以 macOS 为例，一般情况下直接安装。如果没有图标出现，则需进入<code>/Applications/Ollama.app/Contents/Resources/</code>，打开该文件夹下<code>ollama</code>即可。之后便可通过终端运行<code>ollama -v</code>查看软件版本号。软件支持自动更新，无需担心。</p>
<h2><a id="%E9%83%A8%E7%BD%B2deepseek" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>部署 DeepSeek</h2>
<h3><a id="%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E7%89%88%E6%9C%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>选择合适的版本</h3>
<p>到 Ollama 资料库查找 DeepSeek-r1 <a href="https://ollama.com/library/deepseek-r1">https://ollama.com/library/deepseek-r1</a>。<a href="https://github.com/deepseek-ai/DeepSeek-R1">DeepSeek</a>可供下载的有一个满血版671b以及六个蒸馏模型，主要区别如下：</p>
<ul>
<li>DeepSeek-R1-Distill-Qwen-1.5B，要求内存至少8G；</li>
<li>DeepSeek-R1-Distill-Qwen-7B，要求内存至少16GB；</li>
<li>DeepSeek-R1-Distill-Llama-8B，要求内存至少16GB；</li>
<li>DeepSeek-R1-Distill-Qwen-14B，要求内存至少32GB；</li>
<li>DeepSeek-R1-Distill-Qwen-32B，要求内存建议至少32GB；</li>
<li>DeepSeek-R1-Distill-Llama-70B，要求内存48GB以上；</li>
<li>deepseek-r1:671b，俗称满血版，要求内存512GB以上。</li>
</ul>
<p>个人电脑使用蒸馏模型即可。</p>
<h3><a id="%E9%83%A8%E7%BD%B2deepseek-32b" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>部署 DeepSeek 32B</h3>
<p>以<code>DeepSeek-R1-Distill-Qwen-14B</code>为例，在终端执行：</p>
<pre class="line-numbers"><code class="language-zsh">ollama run deepseek-r1:32b
</code></pre>
<p>等待安装完成即可。</p>
<h3><a id="%E9%85%8D%E7%BD%AE%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置浏览器支持</h3>
<p>安装浏览器插件<code>Page Assist</code>，之后便可以通过浏览器运行。</p>
<ul>
<li>Github <a href="https://github.com/n4ze3m/page-assist">https://github.com/n4ze3m/page-assist</a></li>
<li>Firefox：<a href="https://addons.mozilla.org/en-US/firefox/addon/page-assist/">https://addons.mozilla.org/en-US/firefox/addon/page-assist</a></li>
<li>Chrome <a href="https://chromewebstore.google.com/detail/page-assist-%E6%9C%AC%E5%9C%B0-ai-%E6%A8%A1%E5%9E%8B%E7%9A%84-web/jfgfiigpkhlkbnfnbobbkinehhfdhndo?pli=1">https://chromewebstore.google.com/detail/page-assist-%E6%9C%AC%E5%9C%B0-ai-%E6%A8%A1%E5%9E%8B%E7%9A%84-web/jfgfiigpkhlkbnfnbobbkinehhfdhndo?pli=1</a></li>
</ul>
<p>在浏览器中点击<code>Page Assist</code>插件图标，选择模型以及提示词后便可使用 DeepSeek。开启网络搜索结果可能会更好。</p>
<h3><a id="%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参数设置</h3>
<p>来自官方的推荐参数设置。</p>
<ul>
<li>没有 system prompt</li>
<li>温度：0.6</li>
<li>参考搜索与文件上传的官方提示</li>
<li>减轻模型旁路思维</li>
</ul>
<p>中文查询</p>
<pre class="line-numbers"><code class="language-plain_text">search_answer_zh_template = \
'''# 以下内容是基于用户发送的消息的搜索结果:
{search_results}
在我给你的搜索结果中，每个结果都是[webpage X begin]...[webpage X end]格式的，X代表每篇文章的数字索引。请在适当的情况下在句子末尾引用上下文。请按照引用编号[citation:X]的格式在答案中对应部分引用上下文。如果一句话源自多个上下文，请列出所有相关的引用编号，例如[citation:3][citation:5]，切记不要将引用集中在最后返回引用编号，而是在答案对应部分列出。
在回答时，请注意以下几点：
- 今天是{cur_date}。
- 并非搜索结果的所有内容都与用户的问题密切相关，你需要结合问题，对搜索结果进行甄别、筛选。
- 对于列举类的问题（如列举所有航班信息），尽量将答案控制在10个要点以内，并告诉用户可以查看搜索来源、获得完整信息。优先提供信息完整、最相关的列举项；如非必要，不要主动告诉用户搜索结果未提供的内容。
- 对于创作类的问题（如写论文），请务必在正文的段落中引用对应的参考编号，例如[citation:3][citation:5]，不能只在文章末尾引用。你需要解读并概括用户的题目要求，选择合适的格式，充分利用搜索结果并抽取重要信息，生成符合用户要求、极具思想深度、富有创造力与专业性的答案。你的创作篇幅需要尽可能延长，对于每一个要点的论述要推测用户的意图，给出尽可能多角度的回答要点，且务必信息量大、论述详尽。
- 如果回答很长，请尽量结构化、分段落总结。如果需要分点作答，尽量控制在5个点以内，并合并相关的内容。
- 对于客观类的问答，如果问题的答案非常简短，可以适当补充一到两句相关信息，以丰富内容。
- 你需要根据用户要求和回答内容选择合适、美观的回答格式，确保可读性强。
- 你的回答应该综合多个相关网页来回答，不能重复引用一个网页。
- 除非用户要求，否则你回答的语言需要和用户提问的语言保持一致。
 
# 用户消息为：
{question}'''
</code></pre>
<h2><a id="%E5%85%B6%E4%BB%96%E6%94%AF%E6%8C%81%E6%A8%A1%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>其他支持模型</h2>
<p>Ollama 也可以安装其他模型，在网站可查看支持模型列表 <a href="https://ollama.com/library">https://ollama.com/library</a>。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>DeepSeek Github仓库 <a href="https://github.com/deepseek-ai/DeepSeek-R1">https://github.com/deepseek-ai/DeepSeek-R1</a></li>
<li>DeepSeek 官方推荐的部署 DeepSeek-R1 最佳设置参数，和官网一样。 <a href="https://www.appinn.com/deepseek-r1-deploying-recommended-settings/">https://www.appinn.com/deepseek-r1-deploying-recommended-settings/</a></li>
<li>用M1 Max MacBook Pro私有化部署DeepSeek-R1 <a href="https://blog.laoda.de/archives/deploy-deepseek-r1-using-m1-max-macbook-pro">https://blog.laoda.de/archives/deploy-deepseek-r1-using-m1-max-macbook-pro</a></li>
<li>腾讯元宝修改用户协议内容引发热议 <a href="https://news.iqilu.com/shandong/shandonggedi/20250304/5784371.shtml">https://news.iqilu.com/shandong/shandonggedi/20250304/5784371.shtml</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Docker 搭建 FreshRSS]]></title>
    <link href="https://smartdigg.github.io/Docker-install-freshrss.html"/>
    <updated>2026-02-01T13:14:07+08:00</updated>
    <id>https://smartdigg.github.io/Docker-install-freshrss.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85freshrss">快速安装 FreshRSS</a></li>
<li><a href="#docker-compose%E5%AE%89%E8%A3%85">Docker-compose 安装</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85freshrss" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>快速安装 FreshRSS</h2>
<pre class="line-numbers"><code class="language-plain_text"># docker run -d --restart unless-stopped --log-opt max-size=10m \
  -p 8081:80 \
  -e TZ=Europe/Paris \
  -e 'CRON_MIN=1,31' \
  -v freshrss_data:/var/www/FreshRSS/data \
  -v freshrss_extensions:/var/www/FreshRSS/extensions \
  --name freshrss \
  freshrss/freshrss
</code></pre>
<h2><a id="docker-compose%E5%AE%89%E8%A3%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Docker-compose 安装</h2>
<pre class="line-numbers"><code class="language-plain_text">$ mkdir -p /docker/freshrss
$ cd /docker/freshrss
</code></pre>
<p>创建 <code>docker-compose.yml</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">volumes:
  data:
  extensions:

services:
  freshrss:
    image: freshrss/freshrss:latest
    container_name: freshrss
    hostname: freshrss
    restart: unless-stopped
    ports:
      - 8081:80 #映射端口号，8081可自定义
    logging:
      options:
        max-size: 10m
    volumes:
      - data:/var/www/FreshRSS/data
      - extensions:/var/www/FreshRSS/extensions
    environment:
      TZ: Europe/Paris
      CRON_MIN: '1,31'
</code></pre>
<p>启动容器：</p>
<pre class="line-numbers"><code class="language-plain_text"># docker compose up -d
</code></pre>
<p>检查容器状态，正常运行则搭建成功：</p>
<pre class="line-numbers"><code class="language-plain_text"># docker ps
</code></pre>
<p>浏览器访问：<code>域名/id:8081</code></p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li><a href="https://freshrss.org">FreshRSS 官网</a></li>
<li><a href="https://veryjack.com/technique/docker-install-freshrss">笔记｜Docker 快速搭建 FreshRSS</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在 macOS 上使用 aria2]]></title>
    <link href="https://smartdigg.github.io/using-aria2-in-macos.html"/>
    <updated>2025-10-27T20:04:04+08:00</updated>
    <id>https://smartdigg.github.io/using-aria2-in-macos.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E8%A3%85aria2">安装 aria2</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E5%BF%85%E8%A6%81%E6%96%87%E4%BB%B6">创建必要文件</a></li>
<li><a href="#%E7%BC%96%E8%BE%91%E5%90%AF%E5%8A%A8%E9%A1%B9">编辑启动项</a></li>
<li><a href="#%E7%AE%A1%E7%90%86aria2">管理 aria2</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2">安装前端界面</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E5%AE%89%E8%A3%85aria2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 aria2</h2>
<pre class="line-numbers"><code class="language-plain_text">$ brew install aria2
</code></pre>
<h2><a id="%E5%88%9B%E5%BB%BA%E5%BF%85%E8%A6%81%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>创建必要文件</h2>
<pre class="line-numbers"><code class="language-plain_text">$ mkdir  ~/.aria2
$ touch ~/.aria2/aria2.conf ~/.aria2/aria2.session ~/.aria2/dht.dat ~/.aria2/dht6.dat 
</code></pre>
<p>编辑 <code>~/.aria2/aria2.conf</code>：</p>
<pre class="line-numbers"><code class="language-plain_text"># 下载目录。可使用绝对路径或相对路径, 默认: 当前启动位置
dir=${HOME}/Downloads

# 磁盘缓存, 0 为禁用缓存，默认:16M
# 磁盘缓存的作用是把下载的数据块临时存储在内存中，然后集中写入硬盘，以减少磁盘 I/O ，提升读写性能，延长硬盘寿命。
# 建议在有足够的内存空闲情况下适当增加，但不要超过剩余可用内存空间大小。
# 此项值仅决定上限，实际对内存的占用取决于网速 (带宽) 和设备性能等其它因素。
disk-cache=64M

# 文件预分配方式, 可选：none, prealloc, trunc, falloc, 默认:prealloc
# 预分配对于机械硬盘可有效降低磁盘碎片、提升磁盘读写性能、延长磁盘寿命。
# 机械硬盘使用 ext4（具有扩展支持），btrfs，xfs 或 NTFS（仅 MinGW 编译版本）等文件系统建议设置为 falloc
# 若无法下载，提示 fallocate failed.cause：Operation not supported 则说明不支持，请设置为 none
# prealloc 分配速度慢, trunc 无实际作用，不推荐使用。
# 固态硬盘不需要预分配，只建议设置为 none ，否则可能会导致双倍文件大小的数据写入，从而影响寿命。
file-allocation=none

# 断点续传
continue=true

# 获取服务器文件时间，默认:false
remote-time=true


## 进度保存设置 ##

# 从会话文件中读取下载任务
input-file=${HOME}/.aria2/aria2.session

# 会话文件保存路径
# Aria2 退出时或指定的时间间隔会保存 ` 错误 / 未完成 ` 的下载任务到会话文件
save-session=${HOME}/.aria2/aria2.session

# 任务状态改变后保存会话的间隔时间（秒）, 0 为仅在进程正常退出时保存, 默认:0
# 为了及时保存任务状态、防止任务丢失，此项值只建议设置为 1
save-session-interval=1


## 下载连接设置 ##

# 最大同时下载任务数, 运行时可修改, 默认:5
max-concurrent-downloads=5

# 单服务器最大连接线程数, 任务添加时可指定, 默认:1
# 最大值为 16, 且受限于单任务最大连接线程数 (split) 所设定的值。
max-connection-per-server=16

# 单任务最大连接线程数, 任务添加时可指定, 默认:5
split=64

# 文件最小分段大小, 添加时可指定, 取值范围 1M-1024M (增强版最小值为 1K), 默认:20M
# 比如此项值为 10M, 当文件为 20MB 会分成两段并使用两个来源下载, 文件为 15MB 则只使用一个来源下载。
# 理论上值越小使用下载分段就越多，所能获得的实际线程数就越大，下载速度就越快，但受限于所下载文件服务器的策略。
min-split-size=4M

# GZip 支持，默认:false
http-accept-gzip=true

# 使用 UTF-8 处理 Content-Disposition ，默认:false
content-disposition-default-utf8=true


## BT/PT 下载设置 ##

# BT 监听端口(TCP), 默认:6881-6999
# 直通外网的设备，比如 VPS ，务必配置防火墙和安全组策略允许此端口入站
# 内网环境的设备，比如 NAS ，除了防火墙设置，还需在路由器设置外网端口转发到此端口
listen-port=6888

# DHT 网络与 UDP tracker 监听端口(UDP), 默认:6881-6999
# 因协议不同，可以与 BT 监听端口使用相同的端口，方便配置防火墙和端口转发策略。
dht-listen-port=6888

# 启用 IPv4 DHT 功能, PT 下载 (私有种子) 会自动禁用, 默认:true
enable-dht=true

# 启用 IPv6 DHT 功能, PT 下载 (私有种子) 会自动禁用，默认:false
# 在没有 IPv6 支持的环境开启可能会导致 DHT 功能异常
enable-dht6=true

# IPv4 DHT 文件路径，默认：$HOME/.aria2/dht.dat
dht-file-path=${HOME}/.aria2/dht.dat

# IPv6 DHT 文件路径，默认：$HOME/.aria2/dht6.dat
dht-file-path6=${HOME}/.aria2/dht6.dat

# IPv4 DHT 网络引导节点
dht-entry-point=dht.transmissionbt.com:6881

# IPv6 DHT 网络引导节点
dht-entry-point6=dht.transmissionbt.com:6881

# 本地节点发现, PT 下载 (私有种子) 会自动禁用 默认:false
bt-enable-lpd=true

# 启用节点交换, PT 下载 (私有种子) 会自动禁用, 默认:true
enable-peer-exchange=true

# BT 下载最大连接数（单任务），运行时可修改。0 为不限制，默认:55
# 理想情况下连接数越多下载越快，但在实际情况是只有少部分连接到的做种者上传速度快，其余的上传慢或者不上传。
# 如果不限制，当下载非常热门的种子或任务数非常多时可能会因连接数过多导致进程崩溃或网络阻塞。
# 进程崩溃：如果设备 CPU 性能一般，连接数过多导致 CPU 占用过高，因资源不足 Aria2 进程会强制被终结。
# 网络阻塞：在内网环境下，即使下载没有占满带宽也会导致其它设备无法正常上网。因远古低性能路由器的转发性能瓶颈导致。
bt-max-peers=128

# BT 下载期望速度值（单任务），运行时可修改。单位 K 或 M 。默认:50K
# BT 下载速度低于此选项值时会临时提高连接数来获得更快的下载速度，不过前提是有更多的做种者可供连接。
# 实测临时提高连接数没有上限，但不会像不做限制一样无限增加，会根据算法进行合理的动态调节。
bt-request-peer-speed-limit=10M

# 全局最大上传速度限制, 运行时可修改, 默认:0 (无限制)
# 设置过低可能影响 BT 下载速度
max-overall-upload-limit=2M

# 单任务上传速度限制, 默认:0 (无限制)
max-upload-limit=0

# 最小分享率。当种子的分享率达到此选项设置的值时停止做种, 0 为一直做种, 默认:1.0
# 强烈建议您将此选项设置为大于等于 1.0
seed-ratio=1.0

# 最小做种时间（分钟）。设置为 0 时将在 BT 任务下载完成后停止做种。
seed-time=0

# BT 下载优先下载文件开头或结尾
bt-prioritize-piece=head=32M,tail=32M

# 保存通过 WebUI(RPC) 上传的种子文件(.torrent)，默认:true
# 所有涉及种子文件保存的选项都建议开启，不保存种子文件有任务丢失的风险。
# 通过 RPC 自定义临时下载目录可能不会保存种子文件。
rpc-save-upload-metadata=true

# 下载种子文件 (.torrent) 自动开始下载, 默认:true，可选：false|mem
# true：保存种子文件
# false：仅下载种子文件
# mem：将种子保存在内存中
follow-torrent=true

# 保存磁力链接元数据为种子文件(.torrent), 默认:false
bt-save-metadata=true

# 加载已保存的元数据文件(.torrent)，默认:false
bt-load-saved-metadata=true

# 删除 BT 下载任务中未选择文件，默认:false
bt-remove-unselected-file=true

# BT 强制加密, 默认: false
# 启用后将拒绝旧的 BT 握手协议并仅使用混淆握手及加密。可以解决部分运营商对 BT 下载的封锁，且有一定的防版权投诉与迅雷吸血效果。
# 此选项相当于后面两个选项 (bt-require-crypto=true, bt-min-crypto-level=arc4) 的快捷开启方式，但不会修改这两个选项的值。
bt-force-encryption=true

# 分离仅做种任务，默认：false
# 从正在下载的任务中排除已经下载完成且正在做种的任务，并开始等待列表中的下一个任务。
bt-detach-seed-only=true


## 客户端伪装 ##

# 自定义 User Agent
user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36 Edg/93.0.961.47

# BT 客户端伪装
# PT 下载需要保持 user-agent 和 peer-agent 两个参数一致
# 部分 PT 站对 Aria2 有特殊封禁机制，客户端伪装不一定有效，且有封禁账号的风险。
#user-agent=Deluge 1.3.15
peer-agent=Deluge 1.3.15
peer-id-prefix=-DE13F0-


## RPC 设置 ##

# 启用 JSON-RPC/XML-RPC 服务器, 默认:false
enable-rpc=true

# 接受所有远程请求, 默认:false
rpc-allow-origin-all=true

# 允许外部访问, 默认:false
rpc-listen-all=true

# RPC 监听端口, 默认:6800
rpc-listen-port=6800

# RPC 密钥
rpc-secret=&lt;password&gt;

# RPC 最大请求大小
rpc-max-request-size=10M


## 日志设置 ##

# 控制台日志级别，可选 debug, info, notice, warn, error ，默认：notice
console-log-level=info

# 安静模式，禁止在控制台输出日志，默认：false
quiet=false

# 下载进度摘要输出间隔时间（秒），0 为禁止输出。默认：60
summary-interval=0

## BitTorrent trackers ##
bt-tracker=
</code></pre>
<p>修改其中的<password>，记住改密码，稍后要用到。</p>
<h2><a id="%E7%BC%96%E8%BE%91%E5%90%AF%E5%8A%A8%E9%A1%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>编辑启动项</h2>
<p>新建并编辑<code>~/Library/LaunchAgents/homebrew.mxcl.aria2.plist</code>，内容如下：</p>
<pre class="line-numbers"><code class="language-plain_text">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
    &lt;dict&gt;
        &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;homebrew.mxcl.aria2&lt;/string&gt;
        &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
            &lt;string&gt;/opt/homebrew/opt/aria2/bin/aria2c&lt;/string&gt;
        &lt;/array&gt;
        &lt;key&gt;RunAtLoad&lt;/key&gt;
        &lt;true /&gt;
        &lt;key&gt;KeepAlive&lt;/key&gt;
        &lt;true /&gt;
        &lt;key&gt;StandardErrorPath&lt;/key&gt;
        &lt;string&gt;/tmp/aria2.err.log&lt;/string&gt;
        &lt;key&gt;StandardOutPath&lt;/key&gt;
        &lt;string&gt;/tmp/aria2.out.log&lt;/string&gt;
    &lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<h2><a id="%E7%AE%A1%E7%90%86aria2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>管理 aria2</h2>
<p>启动 aria2：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.aria2.plist
</code></pre>
<p>停止 aria2：</p>
<pre class="line-numbers"><code class="language-plain_text">$ launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.aria2.plist
</code></pre>
<p>查看日志：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cat /tmp/aria2.err.log
$ cat /tmp/aria2.out.log
</code></pre>
<h2><a id="%E5%AE%89%E8%A3%85%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装前端界面</h2>
<p>Chromium系浏览器安装 <a href="https://chromewebstore.google.com/detail/aria2-explorer/mpkodccbngfoacfalldjimigbofkhgjn?pli=1">Aria2 Explorer</a>，在 Aria2 Explorer 插件设置<code>Extension Option Settings</code>中<code>Aria2-RPC-Server</code>填入之前的密码，并保存。<br />
<img src="media/17615666440499/aria2-explorer.webp" alt="aria2-explorer" /></p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>如何优雅地在 macOS 上使用 aria2 下载 <a href="https://blog.dov.moe/posts/17623">https://blog.dov.moe/posts/17623</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[屏蔽互联网毒瘤]]></title>
    <link href="https://smartdigg.github.io/how-to-block-internet-rubbish.html"/>
    <updated>2025-08-22T10:21:41+08:00</updated>
    <id>https://smartdigg.github.io/how-to-block-internet-rubbish.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA%E7%BB%88%E7%BB%93%E8%80%85">内容农场终结者</a></li>
<li><a href="#ublacklist">ublacklist</a></li>
<li><a href="#ublock-origin">uBlock Origin</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%BB%91%E5%90%8D%E5%8D%95">自定义黑名单</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA%E7%BB%88%E7%BB%93%E8%80%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>内容农场终结者</h2>
<p>Firefox插件<a href="https://addons.mozilla.org/en-US/firefox/addon/content-farm-terminator/">Content Farm Terminator</a>，安装后即可使用。</p>
<h2><a id="ublacklist" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ublacklist</h2>
<p>Firefox插件<a href="https://addons.mozilla.org/en-US/firefox/addon/ublacklist/">ublacklist</a>，可以阻止垃圾网页出现在搜索引擎的结果中。</p>
<p>推荐列表：</p>
<ul>
<li><a href="https://www.eallion.com/ublacklist-subscription-compilation/">uBlacklist订阅合集</a>，订阅地址：</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">https://raw.githubusercontent.com/eallion/uBlacklist-subscription-compilation/main/uBlacklist.txt
</code></pre>
<ul>
<li><a href="https://github.com/obgnail/chinese-internet-is-dead">chinese-internet-is-dead</a>，订阅地址：</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">https://raw.githubusercontent.com/obgnail/chinese-internet-is-dead/master/blocklist.txt
或者使用 CDN 加速：
https://cdn.jsdelivr.net/gh/obgnail/chinese-internet-is-dead@master/blocklist.txt
</code></pre>
<h2><a id="ublock-origin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>uBlock Origin</h2>
<p>Firefox插件<a href="https://addons.mozilla.org/en-US/firefox/addon/ublock-origin/">uBlock Origin</a>，知名的广告拦截软件。在过滤列表中导入<code>Huge AI Blocklist</code>即可。</p>
<pre class="line-numbers"><code class="language-plain_text">https://raw.githubusercontent.com/laylavish/uBlockOrigin-HUGE-AI-Blocklist/main/list.txt
</code></pre>
<h2><a id="%E8%87%AA%E5%AE%9A%E4%B9%89%E9%BB%91%E5%90%8D%E5%8D%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>自定义黑名单</h2>
<p>可以配合 SmartDNS 使用。在 SmartDNS 文件夹<code>/opt/homebrew/etc/smartdns/</code>新建文件<code>blacklist.txt</code>，其中内容为需要屏蔽的网站域名，格式如下：</p>
<pre class="line-numbers"><code class="language-plain_text">baidu.com
flash.cn
makeding.com
360.cn
2345.com
</code></pre>
<p>在<code>smartdns.conf</code>文件中添加</p>
<pre class="line-numbers"><code class="language-plain_text"># 引入黑名单配置文件
domain-set -name blacklist -file /opt/homebrew/etc/smartdns/blacklist.txt
address /domain-set:blacklist/#
</code></pre>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>为什么中国的互联网流氓软件横行？<a href="https://www.zhihu.com/question/66101490%20">https://www.zhihu.com/question/66101490%20</a></li>
<li>现在的很多国产软件为何如此恶臭？<a href="https://www.zhihu.com/question/434638074">https://www.zhihu.com/question/434638074</a></li>
<li>我是如何坚持10多年站在反百度第一线的 <a href="https://www.huxiu.com/article/136799.html">https://www.huxiu.com/article/136799.html</a></li>
<li>互联网毒瘤——内容农场 <a href="https://www.cnblogs.com/pannengzhi/p/12386268.html">https://www.cnblogs.com/pannengzhi/p/12386268.html</a></li>
<li>扒一扒业界毒瘤思杰马克丁，转型之前是天使转型之后是魔鬼 <a href="https://www.sohu.com/a/343227431_120166973">https://www.sohu.com/a/343227431_120166973</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VPS 搭建 DNS-over-HTTPS 服务器]]></title>
    <link href="https://smartdigg.github.io/configure-DNS-over-HTTPS-on-VPS.html"/>
    <updated>2025-02-23T02:35:50+08:00</updated>
    <id>https://smartdigg.github.io/configure-DNS-over-HTTPS-on-VPS.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87">安装前准备</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6">安装证书</a></li>
<li><a href="#%E5%AE%89%E8%A3%85adguardhome">安装AdGuardHome</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEnginx">配置Nginx</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>选择 AdGuardHome 配置 DNS-over-HTTPS（doh）服务器优势：安装简单，可视化，广告拦截。以 Debian 系统为例。</p>
<h2><a id="%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装前准备</h2>
<ul>
<li>域名<code>example.com</code></li>
<li>DNS 添加 A 记录 <code>doh.example.com</code></li>
<li>VPS，要求延迟要低。</li>
</ul>
<h2><a id="%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装证书</h2>
<p>安装 Nginx：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo apt install nginx
</code></pre>
<p>安装certbot：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo apt install certbot
$ certbot --version
</code></pre>
<p>从Let's Encrypt获取证书：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo certbot certonly --standalone --preferred-challenges http --agree-tos --email you@example.com -d doh.example.com
</code></pre>
<p>证书放置在<code>/etc/letsencrypt/live/doh.example.com/</code>目录下。</p>
<p>测试自动更新证书是否正常</p>
<pre class="line-numbers"><code class="language-bash">$ sudo certbot renew --dry-run
</code></pre>
<p>正常的话，设定两个月自动更新一次证书：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo crontab -e
# 选择 `nano`，复制以下内容保存。
0 0 15 */2 * /usr/bin/certbot renew --quiet
</code></pre>
<h2><a id="%E5%AE%89%E8%A3%85adguardhome" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装AdGuardHome</h2>
<p>使用以下命令自动安装 AdGuardHome：</p>
<pre class="line-numbers"><code class="language-bash">curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v
</code></pre>
<p>VPS防火墙临时放行<code>3000</code>。浏览器访问<code>ip:3000</code>，根据引导进行操作。</p>
<p>配置 DOH（DNS-over-HTTPS）<br />
<img src="media/17402493508620/doh_set.png" alt="doh_set" /></p>
<p>这里不勾选<code>HTTPS自动重定向</code>，HTTPS端口填写<code>8443</code>。</p>
<p>AdGuardHome控制命令：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo /opt/AdGuardHome/AdGuardHome -s start|stop|restart|statuslinstallluninstall
</code></pre>
<h2><a id="%E9%85%8D%E7%BD%AEnginx" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置Nginx</h2>
<p>创建<code>/etc/nginx/conf.d/doh.conf</code>，内容如下：</p>
<pre class="line-numbers"><code class="language-bash">server {
    listen 80;
    listen 443 ssl http2;
    server_name doh.example.com;  #这里填写域名
    index index.php index.html index.htm default.php default.htm default.html
    root /usr/share/nginxt/html;   #网站根目录，指定一个空文件夹即可

    #强制HTTPS
    if ($server_port !~ 443){
            rewrite ^(/.*)$ https://$host$1 permanent;
    }

    # HTTPS证书
	ssl_certificate /etc/letsencrypt/live/doh.example.com/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/doh.example.com/privkey.pem;

    #反向代理仪表盘(可以不配置)
    location ^~ / {
            proxy_pass https://127.0.0.1:8443/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header REMOTE-HOST $remote_addr;
    }

    #反向代理DoH
    location ^~ /dns-query {
            proxy_pass https://127.0.0.1:8443;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header REMOTE-HOST $remote_addr;
    }
}
</code></pre>
<p>测试Nginx配置是否正确：</p>
<pre class="line-numbers"><code class="language-bash">$ nginx -t
</code></pre>
<p>重启Nginx：</p>
<pre class="line-numbers"><code class="language-bash">$ sudo systemctl restart nginx.service
</code></pre>
<p>如果nginx代理配置没有问题，使用浏览器访问<code>https://doh.example.com/dns-query</code>会出现<code>Bad Request</code>信息：<br />
<img src="media/17402493508620/dns_query_test.png" alt="dns_query_test" /><br />
之后便可以在浏览器或手机上使用自建的doh服务。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>AdGuardHome Github repo <a href="https://github.com/AdguardTeam/AdGuardHome/">https://github.com/AdguardTeam/AdGuardHome</a></li>
<li>AdGuardHome 部署与使用指北 <a href="https://fordes.dev/posts/tutorials/ad-guard-home/">https://fordes.dev/posts/tutorials/ad-guard-home</a></li>
<li>使用 AdGuardHome 搭建私人 DNS 广告过滤服务器 <a href="https://blog.renzicu.com/2023/11/438.html">https://blog.renzicu.com/2023/11/438.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS 配置 DNS-over-HTTPS 简化版]]></title>
    <link href="https://smartdigg.github.io/simplified-version-of-DNS-over-HTTPS-for-macOS.html"/>
    <updated>2025-03-09T11:45:48+08:00</updated>
    <id>https://smartdigg.github.io/simplified-version-of-DNS-over-HTTPS-for-macOS.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#mosdns%E8%AE%BE%E7%BD%AE">mosdns设置</a></li>
<li><a href="#dnscrypt-proxy%E8%AE%BE%E7%BD%AE">Dnscrypt-proxy 设置</a></li>
<li><a href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">开机启动</a></li>
</ul>
</div>
<p>详尽版 DNS-over-HTTPS 配置参考：<a href="configure-DNS-over-HTTPS-for-macOS.html">macOS 配置 DNS-over-HTTPS</a>。</p>
<p>简化版 DoH 只需要安装 mosdns 以及 dnscrypt-proxy，不需要 cloudflared 以及 AdGuardHome。mosdns 负责分流以及国内连接，端口设置为<code>53</code>；dnscrypt-proxy 负责国外网络连接，端口设置为<code>5300</code>。</p>
<h2><a id="mosdns%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>mosdns设置</h2>
<p>从 Github 下载安装<a href="https://github.com/IrineSistiana/mosdns">https://github.com/IrineSistiana/mosdns</a>。</p>
<p>解压缩后将整个文件夹移至<code>/opt/local/etc/</code>，并修改配置文件<code>/opt/local/etc/config.yaml</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">log:
    level: info
    file: &quot;/opt/local/etc/mosdns/log.log&quot;

plugins:
    # 缓存
  - tag: cache
    type: cache
    args:
      size: 10240
      lazy_cache_ttl: 86400

   # 转发至国内DNS，并发查询
  - tag: forward_local
    type: forward
    args:
      upstreams:
        - addr: &quot;https://223.5.5.5/dns-query&quot;
        - addr: &quot;https://doh.pub/dns-query&quot;
         # enable_http3: true
        
   # 转发至国外DNS，并发查询
  - tag: forward_remote
    type: forward
    args:
      upstreams:
        - addr: &quot;tcp://127.0.0.1:5300&quot;
        - addr: &quot;udp://127.0.0.1:5300&quot;

   # china ip和自己的vps ip
  - tag: local_ip
    type: ip_set
    args:
      files:
        - /opt/local/etc/mosdns/china_ip_list.txt

     # fallback的primary服务器,返回非国内ip则drop_resp
  - tag: local_sequence
    type: sequence
    args:
      - exec: $forward_local
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: accept
      - exec: drop_resp

  # fallback的secondary服务器,返回非国内ip则添加至ipset,返回国内ip只接受不会添加ipset
  - tag: remote_sequence
    type: sequence
    args:
      - exec: $forward_remote
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: ipset gfwlist,inet,24
      - exec: accept

  # fallback sequence
  - tag: fallback
    type: fallback
    args:
      primary: local_sequence
      secondary: remote_sequence
      threshold: 500
      always_standby: true

    # gfwlist解析出的ip添加至ipset，添加前先判断是否为国内ip或内网ip
  - tag: gfw-list
    type: sequence
    args:
      - exec: ttl 300-3600
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: ipset gfwlist,inet,24
      - exec: accept

    # 主运行序列
  - tag: main_sequence
    type: sequence
    args:
      - matches: qtype 65
        exec: reject 3
    
    # 屏蔽广告
      - matches: qname &amp;/opt/local/etc/mosdns/reject-list.txt
        exec: reject
    # - exec: prefer_ipv4

      # 动态域名跳过缓存
      - matches: &quot;!qname 00006801.com&quot;
        exec: $cache
      - matches: has_resp
        exec: accept

       # 国内域名
      - matches: qname &amp;/opt/local/etc/mosdns/direct-list.txt &amp;/opt/local/etc/mosdns/apple-cn.txt &amp;/opt/local/etc/mosdns/self-defined.txt
        exec: $forward_local
      - matches: has_resp
        exec: accept

       # 国外域名
      - matches: qname &amp;/opt/local/etc/mosdns/proxy-list.txt
        exec: $forward_remote
      - matches: has_resp
        exec: goto gfw-list

      # 其他未知域名
      - exec: $fallback

    # 启动监听服务
  - tag: udp_server
    type: udp_server
    args:
      entry: main_sequence
      listen: &quot;127.0.0.1:53&quot;

  - tag: tcp_server
    type: tcp_server
    args:
      entry: main_sequence
      listen: &quot;127.0.0.1:53&quot;
</code></pre>
<p>部分文件来源：</p>
<ul>
<li><code>china_ip_list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt">https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt</a></li>
<li><code>reject-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt</a></li>
<li><code>direct-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt</a></li>
<li><code>proxy-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt</a></li>
<li><code>apple-cn.txt</code>：<a href="https://github.com/Loyalsoldier/v2ray-rules-dat/blob/release/apple-cn.txt">https://github.com/Loyalsoldier/v2ray-rules-dat/blob/release/apple-cn.txt</a></li>
<li><code>self-defined.txt</code>：自行创建。</li>
</ul>
<p>安装 mosdns 前检查配置是否正确：</p>
<pre class="line-numbers"><code class="language-plain_text">$ /opt/local/etc/mosdns/mosdns start -c /opt/local/etc/mosdns/config.yaml
</code></pre>
<p>安装 mosdns 服务：<br />
格式如下：<code>mosdns service install -d 工作目录绝对路径 -c 配置文件路径</code>。</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/local/etc/mosdns/mosdns service install -d /opt/local/etc/mosdns/ -c /opt/local/etc/mosdns/config.yaml
</code></pre>
<p>运行后将生成启动配置文件<code>/Library/LaunchDaemons/mosdns.plist</code>，该服务将设定 mosdns 随系统启动，但并不会立刻运行。</p>
<p>修改 mosdns 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ vim /Library/LaunchDaemons/mosdns.plist
</code></pre>
<p>修改<code>RunAtLoad</code>的值为<code>true</code>。</p>
<p>启动 mosdns：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/local/etc/mosdns/mosdns service start
</code></pre>
<p>检查 mosdns 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:53
</code></pre>
<p>管理 mosdns 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/local/etc/mosdns/mosdns service start/restart/stop/uninstall
</code></pre>
<h2><a id="dnscrypt-proxy%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dnscrypt-proxy 设置</h2>
<p>安装 dnscrypt-proxy：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew install dnscrypt-proxy
</code></pre>
<p>安装后会自动生成启动配置文件<code>/Library/LaunchDaemons/dnscrypt-proxy.plist</code>。</p>
<p>修改配置文件中的部分内容：<code>/opt/homebrew/etc/dnscrypt-proxy.toml</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">#自由添加server_names
server_names = ['cloudflare','cloudflare-ipv6','libredns','jp.tiar.app-doh', 'doh-crypto-sx', 'uncensoreddns-ipv6', 'cisco'] 

listen_addresses = ['127.0.0.1:5300', '[::1]:5300']

ipv4_servers = false
ipv6_servers = false
dnscrypt_servers = true
doh_servers = true
odoh_servers = true
require_dnssec = false
require_nolog = false
disabled_server_names = ['alidns-doh','dnspod','tuna-doh-ipv6']
</code></pre>
<p>启动 dnscrypt-proxy 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start dnscrypt-proxy
</code></pre>
<p><strong>备注</strong>：这里需要使用<code>sudo</code>命令，目的是为了避免在用户目录下出现重复的配置文件，否则将不断提醒端口占用。</p>
<p>检查 dnscrypt-proxy 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:5300
</code></pre>
<p>管理 dnscrypt-proxy 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start/restart/stop dnscrypt-proxy
</code></pre>
<h2><a id="%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开机启动</h2>
<p>开机启动 mosdns：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo launchctl load -w /Library/LaunchDaemons/mosdns.plist
</code></pre>
<p>开机启动 dnscrypt-proxy：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo launchctl load -w /Library/LaunchDaemons/dnscrypt-proxy.plist
</code></pre>
<p>系统设置：<br />
进入WiFi详细界面，在 DNS 服务器栏中分别填入<code>127.0.0.1</code>以及<code>::1</code>，保存即可。</p>
<p><img src="media/17414919487590/Xnip-DoH-2024.webp" alt="Xnip-DoH-2024" /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自建搜索引擎]]></title>
    <link href="https://smartdigg.github.io/self-hosted-search-engine.html"/>
    <updated>2024-11-30T10:44:45+08:00</updated>
    <id>https://smartdigg.github.io/self-hosted-search-engine.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%85%AC%E5%85%B1%E5%AE%9E%E4%BE%8B">公共实例</a></li>
<li><a href="#whoogle-search">Whoogle Search</a></li>
<li><a href="#searxng">SearXNG</a></li>
<li><a href="#yacy">YaCy</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8Fzerotier">内网穿透Zerotier</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>中国大陆网络搜索环境逐渐恶化，信息检索结果缺乏真实性和可信度。当然用户可以选择国外的搜索引擎直接使用，但这些搜索引擎不保证稳定性或被墙的可能性。有条件的用户可以在自己的 VPS 上自建搜索引擎，并通过内网穿透使用。比较有名的有 Whoogle Search，SearXNG，YaCy等。</p>
<h2><a id="%E5%85%AC%E5%85%B1%E5%AE%9E%E4%BE%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>公共实例</h2>
<p>如果不想自建搜索引擎，也可以直接使用公共实例。</p>
<ul>
<li>Searx Public Instances <a href="https://searx.space">https://searx.space</a></li>
<li>Whoogle Public Instances <a href="https://github.com/benbusby/whoogle-search?tab=readme-ov-file#public-instances">https://github.com/benbusby/whoogle-search?tab=readme-ov-file#public-instances</a></li>
<li>其他<a href="search-engine.html">网络搜索引擎</a></li>
</ul>
<h2><a id="whoogle-search" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Whoogle Search</h2>
<p>Whoogle Search 搜索结果基于 Google 搜索，没有广告也没有追踪。详细介绍看 Github 主页<a href="https://github.com/benbusby/whoogle-search">https://github.com/benbusby/whoogle-search</a>。</p>
<p>Docker CLI 安装：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo docker pull benbusby/whoogle-search
$ sudo docker run --publish 5000:5000 --detach --name whoogle-search benbusby/whoogle-search:latest
</code></pre>
<p>也可以使用 docker-compose 安装：</p>
<pre class="line-numbers"><code class="language-plain_text">$ git clone https://github.com/benbusby/whoogle-search.git
$ cd whoogle-search
$ sudo docker-compose up
</code></pre>
<p>Whoogle Search 的端口为5000。</p>
<h2><a id="searxng" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SearXNG</h2>
<p>相比 Whoogle Search，SearXNG 的搜索结果来自多个搜索引擎。</p>
<p>安装 searxng-docker：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd ~
$ mkdir searxng-docker
$ cd searxng-docker
$ vim docker-compose.yaml
</code></pre>
<p>文件<code>docker-compose.yaml</code>的内容（此处参考<a href="https://nougats.cn/searxng/">使用docker搭建SearXNG搜索引擎</a>）：</p>
<pre class="line-numbers"><code class="language-plain_text">version: '3.7'
 
services:
# 我们注释掉caddy的内容
  #  caddy:
  #  container_name: caddy
  #  image: caddy:2-alpine
  #  network_mode: host
  #  volumes:
  #    - ./Caddyfile:/etc/caddy/Caddyfile:ro
  #    - caddy-data:/data:rw
  #    - caddy-config:/config:rw
  #  environment:
  #    - SEARXNG_HOSTNAME=${SEARXNG_HOSTNAME:-http://localhost:80}
  #    - SEARXNG_TLS=${LETSENCRYPT_EMAIL:-internal}
  #  cap_drop:
  #    - ALL
  #  cap_add:
  #    - NET_BIND_SERVICE
  #    - DAC_OVERRIDE
 
  redis:
    container_name: redis
    image: &quot;redis:alpine&quot;
    command: redis-server --save &quot;&quot; --appendonly &quot;no&quot;
    networks:
      - searxng
    tmpfs:
      - /var/lib/redis
    cap_drop:
      - ALL
    cap_add:
      - SETGID
      - SETUID
      - DAC_OVERRIDE
 
  searxng:
    container_name: searxng
    image: searxng/searxng:latest
    networks:
      - searxng
    ports:
     - &quot;8180:8080&quot;   # 这个冒号左边的端口可以更改，右边的不要改
    volumes:
      - ./searxng:/etc/searxng:rw
    environment:
      - SEARXNG_BASE_URL=https://${SEARXNG_HOSTNAME:-localhost}/
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;1m&quot;
        max-file: &quot;1&quot;
networks:
  searxng:
    ipam:
      driver: default
 
        #volumes:
        #caddy-data:
        #caddy-config:
</code></pre>
<p>生成密钥文件：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sed -i &quot;s|ultrasecretkey|$(openssl rand -hex 32)|g&quot; searxng/settings.yml
</code></pre>
<p>个人使用实例可以将<code>searxng/settings.yml</code>中<code>limiter</code>的值改成<code>false</code>。</p>
<p>启动 Docker 镜像：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo docker-compose up -d  
</code></pre>
<p>SearXNG 端口为8080。</p>
<h2><a id="yacy" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>YaCy</h2>
<p>YaCy 是一款分布式搜索引擎，搜索结果完全由用户自己掌控。YaCy 可以单独安装使用，也可以加入P2P将索引分享给其他人使用。</p>
<p>Docker 安装(适合intel芯片)：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo docker run -d --name yacy_search_server -p 8090:8090 -p 8443:8443 -v yacy_search_server_data:/opt/yacy_search_server/DATA --restart unless-stopped --log-opt max-size=200m --log-opt max-file=2 yacy/yacy_search_server:latest
</code></pre>
<p>YaCy 的端口为8090。</p>
<h2><a id="%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8Fzerotier" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>内网穿透Zerotier</h2>
<p>Zerotier 是一款不错的内网穿透软件，需要在 VPS 及自己常用的设备上同时安装。VPS 以 Linux 系统为例。</p>
<p>安装Zerotier：</p>
<pre class="line-numbers"><code class="language-plain_text">$ curl -s 'https://raw.githubusercontent.com/zerotier/ZeroTierOne/main/doc/contact%40zerotier.com.gpg' | gpg --import &amp;&amp; \  
if z=$(curl -s 'https://install.zerotier.com/' | gpg); then echo &quot;$z&quot; | sudo bash; fi
</code></pre>
<p>开机启动 Zerotier：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo systemctl enable zerotier-one
</code></pre>
<p>加入网络：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo zerotier-cli join ################ 
</code></pre>
<p>其中<code>################</code>为你想加入网络的16位 ID。然后登录 zerotier 官网允许设备即可。</p>
<p>同样地，你也需要在日常使用的设备上安装 zerotier，在<a href="https://www.zerotier.com/download/">Zerotier网站</a>上下载合适的版本。加入相同网络，并登录zerotier官网允许设备。</p>
<p>在 zerotier 官网可以查看所加入网络下所有设备的IP地址，记下你的 VPS 的 IP 地址。假设 VPS 的 IP 地址为<code>10.147.17.102</code>，那么可以通过如下方式访问自建的搜索引擎：</p>
<ul>
<li>Whoogle-search：<a href="http://10.147.17.102:5000">http://10.147.17.102:5000</a></li>
<li>SearXNG：<a href="http://10.147.17.102:8080">http://10.147.17.102:8080</a></li>
<li>YaCy：<a href="http://10.147.17.102:8090">http://10.147.17.102:8090</a></li>
</ul>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>SearXNG Docker <a href="https://github.com/searxng/searxng-docker">https://github.com/searxng/searxng-docker</a></li>
<li>SearXNG Github <a href="https://github.com/searxng/searxng">https://github.com/searxng/searxng</a></li>
<li>whoogle Search <a href="https://github.com/benbusby/whoogle-search">https://github.com/benbusby/whoogle-search</a></li>
<li>YaCy Github <a href="https://github.com/yacy/yacy_search_server">https://github.com/yacy/yacy_search_server</a></li>
<li>YaCy Homepage <a href="https://yacy.net/">https://yacy.net</a></li>
<li>P2P分布式搜索引擎YaCy <a href="https://blog.csdn.net/wbsu2004/article/details/127646231">https://blog.csdn.net/wbsu2004/article/details/127646231</a></li>
<li>使用docker搭建SearXNG搜索引擎 <a href="https://nougats.cn/searxng/">https://nougats.cn/searxng</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SmartDNS 配置]]></title>
    <link href="https://smartdigg.github.io/configure-smartdns.html"/>
    <updated>2024-05-26T12:09:24+08:00</updated>
    <id>https://smartdigg.github.io/configure-smartdns.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#smartdns%E5%AE%89%E8%A3%85">SmartDNS 安装</a>
<ul>
<li><a href="#%E5%9B%BD%E5%86%85%E7%BD%91%E7%AB%99%E5%88%86%E6%B5%81">国内网站分流</a></li>
<li><a href="#%E8%B0%83%E6%95%B4smartdns%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">调整 SmartDNS 配置文件</a></li>
<li><a href="#smartdns%E7%AE%A1%E7%90%86">SmartDNS 管理</a></li>
</ul>
</li>
<li><a href="#smartdns%E5%B1%8F%E8%94%BD%E5%B9%BF%E5%91%8A%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89">SmartDNS 屏蔽广告（可选）</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>在<a href="configure-DNS-over-HTTPS-for-macOS.html">macOS 配置 DNS-over-HTTPS</a>一文中，使用 mosdns 作为转发工具，本文将用 SmartDNS 替换 mosdns，其余配置不变。</p>
<p>优点：用户只需关注网站，无需关注IP地址。</p>
<h2><a id="smartdns%E5%AE%89%E8%A3%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SmartDNS 安装</h2>
<p>使用 homebrew 安装，也可以到官网下载安装<a href="https://github.com/mokeyish/smartdns-rs">https://github.com/mokeyish/smartdns-rs</a>。 SmartDNS 仅作分流和转发，使用端口<code>5304</code>。</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew install smartdns
</code></pre>
<p>默认安装的配置文件位置：<code>/opt/homebrew/etc/smartdns/smartdns.conf</code>。</p>
<h3><a id="%E5%9B%BD%E5%86%85%E7%BD%91%E7%AB%99%E5%88%86%E6%B5%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>国内网站分流</h3>
<p>同时下载国内网站列表<a href="https://github.com/felixonmars/dnsmasq-china-list">felixonmars/dnsmasq-china-list</a>，将整个仓库下载下来。</p>
<p>转化成 SmartDNS 规则：</p>
<pre class="line-numbers"><code class="language-plain_text">$ make SERVER=china smartdns-domain-rules
</code></pre>
<p>将自动生成三个文件：<code>accelerated-domains.china.domain.smartdns.conf</code>、<code>google.china.domain.smartdns.conf</code>以及<code>apple.china.domain.smartdns.conf</code>。</p>
<p>将上述三个文件移动至文件夹<code>/opt/homebrew/etc/smartdns/</code>。<br />
同时，在该文件夹下新建<code>self-defined.conf</code>，作为个人常用国内网站列表，格式参考其他文件。</p>
<h3><a id="%E8%B0%83%E6%95%B4smartdns%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>调整 SmartDNS 配置文件</h3>
<p>修改 SmartDNS 配置文件<code>/opt/homebrew/etc/smartdns/smartdns.conf</code>，大部分不用调整，仅限转发：</p>
<pre class="line-numbers"><code class="language-plain_text"># dns server name, default is host name
# server-name, 
# example:
#   server-name smartdns
#

# whether resolv local hostname to ip address
# resolv-hostname yes

# dns server run user
# user [username]
# example: run as nobody
#   user nobody
#

# Include another configuration options
# conf-file [file]
# conf-file blacklist-ip.conf

conf-file /opt/homebrew/etc/smartdns/self-defined.conf
conf-file /opt/homebrew/etc/smartdns/google.china.domain.smartdns.conf
conf-file /opt/homebrew/etc/smartdns/apple.china.domain.smartdns.conf
conf-file /opt/homebrew/etc/smartdns/accelerated-domains.china.domain.smartdns.conf

# dns server bind ip and port, default dns server port is 53, support binding multi ip and port
# bind udp server
#   bind [IP]:[port][@device] [-group [group]] [-no-rule-addr] [-no-rule-nameserver] [-no-rule-ipset] [-no-speed-check] [-no-cache] [-no-rule-soa] [-no-dualstack-selection]
# bind tcp server
#   bind-tcp [IP]:[port][@device] [-group [group]] [-no-rule-addr] [-no-rule-nameserver] [-no-rule-ipset] [-no-speed-check] [-no-cache] [-no-rule-soa] [-no-dualstack-selection]
# bind tls server
#   bind-tls [IP]:[port][@device] [-group [group]] [-no-rule-addr] [-no-rule-nameserver] [-no-rule-ipset] [-no-speed-check] [-no-cache] [-no-rule-soa] [-no-dualstack-selection]
#   bind-cert-key-file [path to file]
#      tls private key file
#   bind-cert-file [path to file]
#      tls cert file
#   bind-cert-key-pass [password]
#      tls private key password
# option:
#   -group: set domain request to use the appropriate server group.
#   -no-rule-addr: skip address rule.
#   -no-rule-nameserver: skip nameserver rule.
#   -no-rule-ipset: skip ipset rule or nftset rule.
#   -no-speed-check: do not check speed.
#   -no-cache: skip cache.
#   -no-rule-soa: Skip address SOA(#) rules.
#   -no-dualstack-selection: Disable dualstack ip selection.
#   -force-aaaa-soa: force AAAA query return SOA.
#   -set-mark: set mark on packets.
# example: 
#  IPV4: 
#    bind :53
#    bind :53@eth0
#    bind :6053 -group office -no-speed-check
#  IPV6:
#    bind [::]:53
#    bind [::]:53@eth0

bind-tcp :5304
bind :5304
bind-tcp [::]:5304
bind [::]:5304

# tcp connection idle timeout
# tcp-idle-time [second]
tcp-idle-time 300

# dns cache size
# cache-size [number]
#   0: for no cache
cache-size 0

# enable persist cache when restart
# cache-persist no

# cache persist file
# cache-file /tmp/smartdns.cache

# prefetch domain
# prefetch-domain [yes|no]
# prefetch-domain yes

# cache serve expired 
# serve-expired [yes|no]
# serve-expired yes

# cache serve expired TTL
# serve-expired-ttl [num]
# serve-expired-ttl 0

# reply TTL value to use when replying with expired data
# serve-expired-reply-ttl [num]
# serve-expired-reply-ttl 30

# List of hosts that supply bogus NX domain results 
# bogus-nxdomain [ip/subnet]

# List of IPs that will be filtered when nameserver is configured -blacklist-ip parameter
# blacklist-ip [ip/subnet]

# List of IPs that will be accepted when nameserver is configured -whitelist-ip parameter
# whitelist-ip [ip/subnet]

# List of IPs that will be ignored
# ignore-ip [ip/subnet]

# speed check mode
# speed-check-mode [ping|tcp:port|none|,]
# example:
#   speed-check-mode ping,tcp:80,tcp:443
#   speed-check-mode tcp:443,ping
speed-check-mode none

# force AAAA query return SOA
# force-AAAA-SOA [yes|no]

# force specific qtype return soa
# force-qtype-SOA [qtypeid |...]
# force-qtype-SOA 65 28
force-qtype-SOA 65

# Enable IPV4, IPV6 dual stack IP optimization selection strategy
# dualstack-ip-selection-threshold [num] (0~1000)
# dualstack-ip-allow-force-AAAA [yes|no]
# dualstack-ip-selection [yes|no]
# dualstack-ip-selection no

# edns client subnet
# edns-client-subnet [ip/subnet]
# edns-client-subnet 192.168.1.1/24
# edns-client-subnet 8::8/56

# ttl for all resource record
# rr-ttl: ttl for all record
# rr-ttl-min: minimum ttl for resource record
# rr-ttl-max: maximum ttl for resource record
# rr-ttl-reply-max: maximum reply ttl for resource record
# example:
rr-ttl 60
rr-ttl-min 0
rr-ttl-max 86400
# rr-ttl-reply-max 60

# Maximum number of IPs returned to the client|8|number of IPs, 1~16
# example:
# max-reply-ip-num 1

# response mode
# Experimental feature
# response-mode [first-ping|fastest-ip|fastest-response]

# set log level
# log-level: [level], level=fatal, error, warn, notice, info, debug
# log-file: file path of log file.
# log-console [yes|no]: output log to console.
# log-size: size of each log file, support k,m,g
# log-num: number of logs, 0 means disable log
log-level warn

log-file /opt/homebrew/etc/smartdns/smartdns.log
log-size 1024k
# log-num 2
# log-file-mode [mode]: file mode of log file.

# dns audit
# audit-enable [yes|no]: enable or disable audit.
# audit-enable yes
# audit-SOA [yes|no]: enable or disable log soa result.
# audit-size size of each audit file, support k,m,g
# audit-file /var/log/smartdns-audit.log
# audit-console [yes|no]: output audit log to console.
# audit-file-mode [mode]: file mode of audit file.
# audit-size 128k
# audit-num 2

# Support reading dnsmasq dhcp file to resolve local hostname
# dnsmasq-lease-file /var/lib/misc/dnsmasq.leases

# certificate file
# ca-file [file]
# ca-file /etc/ssl/certs/ca-certificates.crt

# certificate path
# ca-path [path]
# ca-path /etc/ss/certs

# remote udp dns server list
# server [IP]:[PORT]|URL [-blacklist-ip] [-whitelist-ip] [-check-edns] [-group [group] ...] [-exclude-default-group]
# default port is 53
#   -blacklist-ip: filter result with blacklist ip
#   -whitelist-ip: filter result with whitelist ip,  result in whitelist-ip will be accepted.
#   -check-edns: result must exist edns RR, or discard result.
#   -group [group]: set server to group, use with nameserver /domain/group.
#   -exclude-default-group: exclude this server from default group.
#   -proxy [proxy-name]: use proxy to connect to server.
#   -bootstrap-dns: set as bootstrap dns server.
# server 8.8.8.8 -blacklist-ip -check-edns -group g1 -group g2
# server tls://dns.google:853 
# server https://dns.google/dns-query

server 127.0.0.1:5300
server 127.0.0.1:5305 -group china -exclude-default-group

# remote tcp dns server list
# server-tcp [IP]:[PORT] [-blacklist-ip] [-whitelist-ip] [-group [group] ...] [-exclude-default-group]
# default port is 53
# server-tcp 8.8.8.8

server-tcp 127.0.0.1:5300
server-tcp 127.0.0.1:5305 -group china -exclude-default-group

# server-https https://223.5.5.5/dns-query -group china -exclude-default-group
# server-https https://doh.pub/dns-query -group china -exclude-default-group

# remote tls dns server list
# server-tls [IP]:[PORT] [-blacklist-ip] [-whitelist-ip] [-spki-pin [sha256-pin]] [-group [group] ...] [-exclude-default-group]
#   -spki-pin: TLS spki pin to verify.
#   -tls-host-verify: cert hostname to verify.
#   -host-name: TLS sni hostname.
#   -no-check-certificate: no check certificate.
#   -proxy [proxy-name]: use proxy to connect to server.
#   -bootstrap-dns: set as bootstrap dns server.
# Get SPKI with this command:
#    echo | openssl s_client -connect '[ip]:853' | openssl x509 -pubkey -noout | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | openssl enc -base64
# default port is 853
# server-tls 8.8.8.8
# server-tls 1.0.0.1

# server-tls 223.5.5.5:853 -group china -exclude-default-group
# server-tls 223.6.6.6:853 -group china -exclude-default-group


# remote https dns server list
# server-https https://[host]:[port]/path [-blacklist-ip] [-whitelist-ip] [-spki-pin [sha256-pin]] [-group [group] ...] [-exclude-default-group]
#   -spki-pin: TLS spki pin to verify.
#   -tls-host-verify: cert hostname to verify.
#   -host-name: TLS sni hostname.
#   -http-host: http host.
#   -no-check-certificate: no check certificate.
#   -proxy [proxy-name]: use proxy to connect to server.
#   -bootstrap-dns: set as bootstrap dns server.
# default port is 443
# server-https https://cloudflare-dns.com/dns-query

# socks5 and http proxy list
# proxy-server URL -name [proxy name]
#   URL: socks5://[username:password@]host:port
#        http://[username:password@]host:port
#   -name: proxy name, use with server -proxy [proxy-name]
# example:
#   proxy-server socks5://user:pass@1.2.3.4:1080 -name proxy
#   proxy-server http://user:pass@1.2.3.4:3128 -name proxy

# specific nameserver to domain
# nameserver /domain/[group|-]
# nameserver /www.example.com/office, Set the domain name to use the appropriate server group.
# nameserver /www.example.com/-, ignore this domain

# specific address to domain
# address /domain/[ip|-|-4|-6|#|#4|#6]
# address /www.example.com/1.2.3.4, return ip 1.2.3.4 to client
# address /www.example.com/-, ignore address, query from upstream, suffix 4, for ipv4, 6 for ipv6, none for all
# address /www.example.com/#, return SOA to client, suffix 4, for ipv4, 6 for ipv6, none for all

# specific cname to domain
# cname /domain/target

# enalbe DNS64 feature
# dns64 [ip/subnet]
# dns64 64:ff9b::/96

# enable ipset timeout by ttl feature
# ipset-timeout [yes]

# specific ipset to domain
# ipset /domain/[ipset|-]
# ipset /www.example.com/block, set ipset with ipset name of block 
# ipset /www.example.com/-, ignore this domain

# add to ipset when ping is unreachable
# ipset-no-speed ipsetname
# ipset-no-speed pass

# enable nftset timeout by ttl feature
# nftset-timeout [yes|no]
# nftset-timeout yes

# add to nftset when ping is unreachable
# nftset-no-speed [#4:ip#table#set,#6:ipv6#table#setv6]
# nftset-no-speed #4:ip#table#set

# enable nftset debug, check nftset setting result, output log when error.
# nftset-debug [yes|no]
# nftset-debug yes

# specific nftset to domain
# nftset /domain/[#4:ip#table#set,#6:ipv6#table#setv6]
# nftset /www.example.com/ip#table#set, equivalent to 'nft add element ip table set { ... }'
# nftset /www.example.com/-, ignore this domain
# nftset /www.example.com/#6:-, ignore ipv6

# set domain rules
# domain-rules /domain/ [-speed-check-mode [...]]
# rules:
#   [-c] -speed-check-mode [mode]: speed check mode
#                             speed-check-mode [ping|tcp:port|none|,]
#   [-a] -address [address|-]: same as address option
#   [-n] -nameserver [group|-]: same as nameserver option
#   [-p] -ipset [ipset|-]: same as ipset option
#   [-t] -nftset [nftset|-]: same as nftset option
#   [-d] -dualstack-ip-selection [yes|no]: same as dualstack-ip-selection option
#   -no-serve-expired: ignore expired domain
#   -delete: delete domain rule

# collection of domains 
# the domain-set can be used with /domain/ for address, nameserver, ipset, etc.
# domain-set -name [set-name] -type list -file [/path/to/file]
#   [-n] -name [set name]: domain set name
#   [-t] -type [list]: domain set type, list only now
#   [-f] -file [path/to/set]: file path of domain set
# 
# example:
# domain-set -name domain-list -type list -file /etc/smartdns/domain-list.conf
# address /domain-set:domain-list/1.2.3.4
# nameserver /domain-set:domain-list/server-group
# ipset /domain-set:domain-list/ipset
# domain-rules /domain-set:domain-list/ -speed-check-mode ping
</code></pre>
<h3><a id="smartdns%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SmartDNS 管理</h3>
<p>暂停 mosdns：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew services stop mosdns
$ sudo /opt/local/etc/mosdns/mosdns service uninstall
</code></pre>
<p>启动 SmartDNS：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start smartdns
</code></pre>
<p>使用<code>sudo</code>命令会自动添加到开机启动项，启动配置文件位置：<code>/Library/LaunchDaemons/homebrew.mxcl.smartdns.plist</code>。</p>
<p>如果不需要后台服务，可以执行命令：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/homebrew/opt/smartdns/sbin/smartdns run -c /opt/homebrew/etc/smartdns/smartdns.conf
</code></pre>
<p>检查 SmartDNS 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:5304
</code></pre>
<p>重启与暂停 SmartDNS：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo brew services start/restart/stop smartdns
</code></pre>
<h2><a id="smartdns%E5%B1%8F%E8%94%BD%E5%B9%BF%E5%91%8A%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SmartDNS 屏蔽广告（可选）</h2>
<p>由于 SmartDNS 也具有屏蔽广告的功能，可以不再需要 AdGuardHome，仅需将 AdGuardHome 关闭，并将 SmartDNS 端口设置为53即可。</p>
<ol>
<li>下载配置文件到目录<code>/opt/homebrew/etc/smartdns/</code></li>
</ol>
<pre class="line-numbers"><code class="language-plain_text">$ wget https://anti-ad.net/anti-ad-for-smartdns.conf -O /opt/homebrew/etc/smartdns/anti-ad-smartdns.conf
</code></pre>
<ol start="2">
<li>修改<code>/opt/homebrew/etc/smartdns/smartdns.conf</code>文件，包含上述配置文件</li>
</ol>
<pre class="line-numbers"><code class="language-plain_text">conf-file /opt/homebrew/etc/smartdns/anti-ad-smartdns.conf
</code></pre>
<p>其他广告列表见<a href="https://pymumu.github.io/smartdns/config/ad-block/">SmartDNS广告过滤列表</a>，可以定期下载更新文件，并重启 SmartDNS 生效。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>Dnsmasq-china-list<br />
<a href="https://github.com/felixonmars/dnsmasq-china-list">https://github.com/felixonmars/dnsmasq-china-list</a></li>
<li>SmartDNS <a href="https://github.com/mokeyish/smartdns-rs/">https://github.com/mokeyish/smartdns-rs</a></li>
<li>SmartDNS文档主页 <a href="https://pymumu.github.io/smartdns/">https://pymumu.github.io/smartdns/</a></li>
<li>SmartDNS分流加速 <a href="https://fordes.dev/posts/tutorials/dns-shunt/">https://fordes.dev/posts/tutorials/dns-shunt</a></li>
<li>超简易的方法实现SmartDNS分组 <a href="https://www.right.com.cn/forum/thread-4244241-1-1.html">https://www.right.com.cn/forum/thread-4244241-1-1.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS 配置 DNS-over-HTTPS]]></title>
    <link href="https://smartdigg.github.io/configure-DNS-over-HTTPS-for-macOS.html"/>
    <updated>2024-05-24T18:55:49+08:00</updated>
    <id>https://smartdigg.github.io/configure-DNS-over-HTTPS-for-macOS.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#cloudflared%E9%85%8D%E7%BD%AE">cloudflared 配置</a></li>
<li><a href="#dnscrypt-proxy%E9%85%8D%E7%BD%AE">dnscrypt-proxy 配置</a></li>
<li><a href="#mosdns%E9%85%8D%E7%BD%AE">mosdns配置</a></li>
<li><a href="#adguardhome%E9%85%8D%E7%BD%AE">AdGuardHome 配置</a>
<ul>
<li><a href="#%E7%AE%A1%E7%90%86adguardhome">管理 AdGuardHome</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">开机启动</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>基本要求：应对 GFW 以及国内的流氓互联网公司，所有流量必需经过 DNS-over-HTTPS。</p>
<p>主要思路：</p>
<ol>
<li>使用 cloudflared 处理国内网站，端口5305；</li>
<li>使用 dnscrypt-proxy 处理国外网站，端口5300；</li>
<li>使用 mosdns 分流，端口5304；</li>
<li>使用 AdGuardHome 去广告以及管理黑名单，端口53。</li>
</ol>
<p>备注：第四步为可选步骤，仅需将mosdns的端口修改为53。</p>
<h2><a id="cloudflared%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>cloudflared 配置</h2>
<p>使用 homebrew 安装，也可以到官网下载安装<a href="https://github.com/cloudflare/cloudflared">https://github.com/cloudflare/cloudflared</a>。cloudflared 负责解析国内网站，使用端口<code>5305</code>。</p>
<p>安装 cloudflared：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew install cloudflared
$ mkdir -p /usr/local/etc/cloudflared
</code></pre>
<p>编辑文件<code>/usr/local/etc/cloudflared/config.yml</code>，没有便创建一个：</p>
<pre class="line-numbers"><code class="language-plain_text">proxy-dns: true
proxy-dns-port: 5305
proxy-dns-upstream:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
</code></pre>
<p>安装到系统：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo cloudflared service install
</code></pre>
<p>该命令会生成启动配置文件<code>/Library/LaunchDaemons/com.cloudflare.cloudflared.plist</code>。</p>
<p>检查 cloudflared 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:5305
</code></pre>
<p>更新或重启 cloudflared：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo cloudflared service uninstall &amp;&amp; sudo cloudflared service install
</code></pre>
<h2><a id="dnscrypt-proxy%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>dnscrypt-proxy 配置</h2>
<p>使用 homebrew 安装，也可以从 Github 下载安装<a href="https://github.com/DNSCrypt/dnscrypt-proxy/">https://github.com/DNSCrypt/dnscrypt-proxy/</a>。dnscrypt-proxy 负责解析国外网站，使用端口<code>5300</code>。</p>
<p>安装dnscrypt-proxy：</p>
<pre class="line-numbers"><code class="language-plain_text">$ brew install dnscrypt-proxy
</code></pre>
<p>安装后会自动生成启动配置文件<code>/Library/LaunchDaemons/dnscrypt-proxy.plist</code>。</p>
<p>修改配置文件中的部分内容：<code>/opt/homebrew/etc/dnscrypt-proxy.toml</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">#自由添加server_names
server_names = ['cloudflare','cloudflare-ipv6','libredns','jp.tiar.app-doh', 'doh-crypto-sx', 'uncensoreddns-ipv6', 'cisco'] 

listen_addresses = ['127.0.0.1:5300', '[::1]:5300']

ipv4_servers = false
ipv6_servers = false
dnscrypt_servers = true
doh_servers = true
odoh_servers = true
require_dnssec = false
require_nolog = false
disabled_server_names = ['alidns-doh', 'dnspod']
</code></pre>
<p>启动dnscrypt-proxy服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$sudo brew services start dnscrypt-proxy
</code></pre>
<p>检查 dnscrypt-proxy 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:5300
</code></pre>
<p>管理 dnscrypt-proxy 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$sudo brew services start/stop/restart dnscrypt-proxy
</code></pre>
<p><strong>备注</strong>：不要使用不带<code>sudo</code>的命令：<code>brew services start/stop/restart dnscrypt-proxy</code>，这是为了避免在如下位置出现导致端口冲突提醒的配置文件：<code>~/Library/LaunchAgents/homebrew.mxcl.dnscrypt-proxy.plist</code>。</p>
<h2><a id="mosdns%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>mosdns配置</h2>
<p>从 Github 下载安装<a href="https://github.com/IrineSistiana/mosdns">https://github.com/IrineSistiana/mosdns</a>。mosdns 仅作分流和转发，使用端口<code>5304</code>。</p>
<p>解压缩后，将整个文件夹移至<code>/opt/local/etc/</code>，修改配置文件<code>/opt/local/etc/config.yaml</code>：</p>
<pre class="line-numbers"><code class="language-plain_text">log:
    level: info
    file: &quot;/opt/local/etc/mosdns/log.log&quot;

plugins:
    # 缓存
  - tag: cache
    type: cache
    args:
      size: 10240
      lazy_cache_ttl: 86400

   # 转发至国内DNS
  - tag: forward_local
    type: forward
    args:
      upstreams:
        - addr: &quot;tcp://127.0.0.1:5305&quot;
        - addr: &quot;udp://127.0.0.1:5305&quot;

        #- addr: &quot;https://223.5.5.5/dns-query&quot;
        #- addr: &quot;https://doh.pub/dns-query&quot;
        #  enable_http3: true
        

   # 转发至国外DNS
  - tag: forward_remote
    type: forward
    args:
      upstreams:
        - addr: &quot;tcp://127.0.0.1:5300&quot;
        - addr: &quot;udp://127.0.0.1:5300&quot;

   # china-ip
  - tag: local_ip
    type: ip_set
    args:
      files:
        - /opt/local/etc/mosdns/china_ip_list.txt

   # fallback的primary服务器,返回非国内ip则drop_resp
  - tag: local_sequence
    type: sequence
    args:
      - exec: $forward_local
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: accept
      - exec: drop_resp

  # fallback的secondary服务器,返回非国内ip则添加至ipset,返回国内ip只接受不会添加ipset
  - tag: remote_sequence
    type: sequence
    args:
      - exec: $forward_remote
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: ipset gfwlist,inet,24
      - exec: accept

  # fallback sequence
  - tag: fallback
    type: fallback
    args:
      primary: local_sequence
      secondary: remote_sequence
      threshold: 500
      always_standby: true

    # gfwlist解析出的ip添加至ipset，添加前先判断是否为国内ip或内网ip
  - tag: gfw-list
    type: sequence
    args:
      - exec: ttl 300-3600
      - matches: &quot;!resp_ip $local_ip&quot;
        exec: ipset gfwlist,inet,24
      - exec: accept

    # 主运行序列
  - tag: main_sequence
    type: sequence
    args:
      - matches: qtype 65
        exec: reject 3

      - matches: qname &amp;/opt/local/etc/mosdns/reject-list.txt
        exec: reject
    # - exec: prefer_ipv4

      # 动态域名跳过缓存
      - matches: &quot;!qname 00006801.com&quot;
        exec: $cache
      - matches: has_resp
        exec: accept

      - matches: qname &amp;/opt/local/etc/mosdns/direct-list.txt &amp;/opt/local/etc/mosdns/apple-cn.txt &amp;/opt/local/etc/mosdns/self-defined.txt
        exec: $forward_local
      - matches: has_resp
        exec: accept

      - matches: qname &amp;/opt/local/etc/mosdns/proxy-list.txt
        exec: $forward_remote
      - matches: has_resp
        exec: goto gfw-list

      - exec: $fallback

    # 启动监听服务
  - tag: udp_server
    type: udp_server
    args:
      entry: main_sequence
      listen: &quot;127.0.0.1:5304&quot;

  - tag: tcp_server
    type: tcp_server
    args:
      entry: main_sequence
      listen: &quot;127.0.0.1:5304&quot;
</code></pre>
<p>部分文件来源：</p>
<ul>
<li><code>china_ip_list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt">https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt</a></li>
<li><code>reject-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt</a></li>
<li><code>direct-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt</a></li>
<li><code>proxy-list.txt</code>：<a href="https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt">https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt</a></li>
<li><code>apple-cn.txt</code>：<a href="https://github.com/Loyalsoldier/v2ray-rules-dat/blob/release/apple-cn.txt">https://github.com/Loyalsoldier/v2ray-rules-dat/blob/release/apple-cn.txt</a></li>
<li><code>self-defined.txt</code>：自行创建。</li>
</ul>
<p>安装前检查配置是否正确：</p>
<pre class="line-numbers"><code class="language-plain_text">$ /opt/local/etc/mosdns/mosdns start -c /opt/local/etc/mosdns/config.yaml
</code></pre>
<p>安装 mosdns 服务：</p>
<pre class="line-numbers"><code class="language-plain_text"># mosdns service install -d 工作目录绝对路径 -c 配置文件路径
$ /opt/local/etc/mosdns/mosdns service install -d /opt/local/etc/mosdns/ -c /opt/local/etc/mosdns/config.yaml
</code></pre>
<p>服务仅设定为随系统自启，启动配置文件位置：<code>/Library/LaunchDaemons/mosdns.plist</code>。</p>
<p>安装成功后并不会马上运行，需手动启动。</p>
<p>查看 mosdns 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">cat /Library/LaunchDaemons/mosdns.plist
</code></pre>
<p>修改<code>RunAtLoad</code>的值为<code>true</code>。</p>
<p>启动 mosdns：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/local/etc/mosdns/mosdns service start
</code></pre>
<p>检查 mosdns 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:5304
</code></pre>
<p>管理 mosdns 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /opt/local/etc/mosdns/mosdns service stop/uninstall
</code></pre>
<p>备注：mosdns 可替代 cloudflared 服务，仅需要修改配置文件中<code>forward_local</code>部分，示例代码已提示。唯一区别是 cloudflared 服务非常稳定。</p>
<h2><a id="adguardhome%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>AdGuardHome 配置</h2>
<p>从 Github 下载安装 <a href="https://github.com/AdguardTeam/AdGuardHome">https://github.com/AdguardTeam/AdGuardHome</a>。</p>
<p>解压缩，并将<code>AdGuardHome</code>文件夹移动至<code>/Applications/</code>目录下。</p>
<p>启动 AdGuardHome：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd /Applications/AdGuardHome/ &amp;&amp; sudo /Applications/AdGuardHome/AdGuardHome 
</code></pre>
<p>网页管理界面监听接口选择<code>所有接口</code>，端口选择<code>3000</code>；<br />
DNS 服务器监听选择<code>所有接口</code>，端口选择<code>53</code>；<br />
然后设置用户名和用户密码。</p>
<p>安装到系统服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd /Applications/AdGuardHome/ &amp;&amp; sudo /Applications/AdGuardHome/AdGuardHome -s install
</code></pre>
<p>安装后会生成启动配置文件：<code>/Library/LaunchDaemons/AdGuardHome.plist</code>。</p>
<p>启动 AdGuardHome 服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /Applications/AdGuardHome/AdGuardHome -s start
</code></pre>
<p>打开浏览器，输入网址 <a href="http://127.0.0.1:3000/">http://127.0.0.1:3000/ </a>即可访问 AdGuardHome 的管理界面。</p>
<p>在 DNS 设置中填入上游 DNS 服务器地址：<code>127.0.0.1:5304</code>以及<code>[::]:5304</code>。</p>
<p>过滤器可视情况添加：</p>
<ol>
<li>EasyList Adblock Plus 官方维护的广告规则。链接：<a href="https://easylist-downloads.adblockplus.org/easylist.txt">https://easylist-downloads.adblockplus.org/easylist.txt</a></li>
<li>EasyList China：国内网站广告过滤的主规则。链接：<a href="https://easylist-downloads.adblockplus.org/easylistchina.txt">https://easylist-downloads.adblockplus.org/easylistchina.txt</a></li>
<li>EasyPrivacy：反隐私跟踪、挖矿规则。链接：<a href="https://easylist-downloads.adblockplus.org/easyprivacy.txt">https://easylist-downloads.adblockplus.org/easyprivacy.txt</a></li>
<li>CJX's Annoyance List：过滤烦人的自我推广，并补充EasyPrivacy 隐私规则。链接：<a href="https://raw.githubusercontent.com/cjx82630/cjxlist/master/cjx-annoyance.txt">https://raw.githubusercontent.com/cjx82630/cjxlist/master/cjx-annoyance.txt</a></li>
<li>I don't care about cookies：屏蔽网站的cookies相关的警告。链接：<a href="https://www.i-dont-care-about-cookies.eu/abp/">https://www.i-dont-care-about-cookies.eu/abp/</a></li>
<li>anti-AD：中文区去广告。链接：<a href="https://anti-ad.net/easylist.txt">https://anti-ad.net/easylist.txt</a></li>
<li>Fanboy's Annoyances List 去除页面弹窗广告规则 链接：<a href="https://easylist-downloads.adblockplus.org/fanboy-annoyance.txt">https://easylist-downloads.adblockplus.org/fanboy-annoyance.txt</a></li>
<li>Github520 直连Github <a href="https://raw.hellogithub.com/hosts">https://raw.hellogithub.com/hosts</a></li>
<li>HalfLife	合并自EasylistChina、EasylistLite、CJX’sAnnoyance <a href="https://cdn.jsdelivr.net/gh/o0HalfLife0o/list@master/ad-pc.txt">https://cdn.jsdelivr.net/gh/o0HalfLife0o/list@master/ad-pc.txt</a></li>
</ol>
<p>检查 AdGuardHome 是否正常启动：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo lsof -Pni UDP:53
</code></pre>
<h3><a id="%E7%AE%A1%E7%90%86adguardhome" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>管理 AdGuardHome</h3>
<p>配置文件：<code>/Applications/AdGuardHome/AdGuardHome.yaml</code>。</p>
<p>删除 AdGuardHome 系统服务：</p>
<pre class="line-numbers"><code class="language-plain_text">$ cd /Applications/AdGuardHome/ &amp;&amp; sudo /Applications/AdGuardHome/AdGuardHome -s uninstall
</code></pre>
<p>日常管理 AdGuardHome：</p>
<pre class="line-numbers"><code class="language-plain_text">$ sudo /Applications/AdGuardHome/AdGuardHome -s start/stop/restart/status
</code></pre>
<p>设置开机启动 AdGuardHome：</p>
<pre class="line-numbers"><code class="language-plain_text">#启动AdGuardHome
$ sudo launchctl start /Library/LaunchDaemons/AdGuardHome.plist 
</code></pre>
<h2><a id="%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开机启动</h2>
<p>一般情况下，完成以上步骤便已将所有服务添加至开机启动项，如果没有则需要手动添加：</p>
<pre class="line-numbers"><code class="language-plain_text">#开机启动cloudflared
$ sudo launchctl load -w /Library/LaunchDaemons/com.cloudflare.cloudflared.plist

# 开机启动dnscrypt-proxy
$ sudo launchctl load -w /Library/LaunchDaemons/dnscrypt-proxy.plist

# 开机启动mosdns
$ sudo launchctl load -w /Library/LaunchDaemons/mosdns.plist

# 开机启动AdGuardHome
$ sudo launchctl load -w /Library/LaunchDaemons/AdGuardHome.plist
</code></pre>
<p>最后，需要修改系统DNS：</p>
<ol>
<li>在 Mac 上，选取苹果菜单&gt;“系统设置”，然后点按边栏中的“网络”。</li>
<li>点按要使用的网络服务（例如Wi-Fi或以太网），然后点按“详细信息”。</li>
<li>点按 DNS ，点按“DNS服务器”列表底部的“添加”按钮，然后输入 DNS 服务器的IPv4<code>127.0.0.1</code>或IPv6地址<code>::1</code>。</li>
<li>完成后，点按“好”。</li>
</ol>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>How to protect your network with AdGuard Home <a href="https://meshnet.nordvpn.com/how-to/security/protect-network-with-adguard-home">https://meshnet.nordvpn.com/how-to/security/protect-network-with-adguard-home</a></li>
<li>mosdns-wiki-zh <a href="https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5">https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5</a></li>
<li>AdGuard Home自建DNS防污染、去广告教程 #2 - 优化增强设置详解 <a href="https://p3terx.com/archives/use-adguard-home-to-build-dns-to-prevent-pollution-and-remove-ads-2.html">https://p3terx.com/archives/use-adguard-home-to-build-dns-to-prevent-pollution-and-remove-ads-2.html</a></li>
<li>cloudflared (DoH) <a href="https://docs.pi-hole.net/guides/dns/cloudflared/">https://docs.pi-hole.net/guides/dns/cloudflared</a></li>
<li>MacOS配置DNS Over HTTPS <a href="https://cat.ms/macos-use-doh">https://cat.ms/macos-use-doh</a></li>
<li>国内国外域名分流的配置 <a href="https://github.com/IrineSistiana/mosdns/discussions/605">https://github.com/IrineSistiana/mosdns/discussions/605</a></li>
<li>基于DNS的内网代理分流方案 <a href="https://github.com/Sereinfy/mosdns-config">https://github.com/Sereinfy/mosdns-config</a></li>
<li>利用Mosdns(v4 or v5)和AdGuardHome搭建自己的DNS <a href="https://www.xukecheng.tech/use-mosdns-and-adguardhome-to-build-your-own-dns">https://www.xukecheng.tech/use-mosdns-and-adguardhome-to-build-your-own-dns</a></li>
<li>在Mac上输入DNS和搜索域设置 <a href="https://support.apple.com/zh-cn/guide/mac-help/mh141272/mac">https://support.apple.com/zh-cn/guide/mac-help/mh141272/mac</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VPS 安装 MTProxy]]></title>
    <link href="https://smartdigg.github.io/VPS-install-mtproxy.html"/>
    <updated>2026-02-01T23:26:41+08:00</updated>
    <id>https://smartdigg.github.io/VPS-install-mtproxy.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E7%94%9F%E6%88%90secret-key">生成 Secret Key</a></li>
<li><a href="#%E6%96%B0%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">新建配置文件</a></li>
<li><a href="#%E5%AE%89%E8%A3%85mtproxy">安装 MTProxy</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8mtproxy">使用 MTProxy</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E7%94%9F%E6%88%90secret-key" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>生成 Secret Key</h2>
<p>连接 VPS，执行如下命令：</p>
<pre class="line-numbers"><code class="language-plain_text">sudo docker run --rm nineseconds/mtg:2 generate-secret --hex ifeng.com
</code></pre>
<p>这条命令可以快速生成一组 Secret Key 并开启 TLS 混淆，让你假装在连接ifeng.com。记住该字符串，稍后将用到。</p>
<h2><a id="%E6%96%B0%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>新建配置文件</h2>
<pre class="line-numbers"><code class="language-plain_text">$ sudo vim /etc/mtg-config.toml
</code></pre>
<p>内容如下：</p>
<pre class="line-numbers"><code class="language-plain_text">secret = &quot;ee9394946fae27cb52106f7923a27faa4c7a686968752e636f6d&quot;
bind-to = &quot;0.0.0.0:3128&quot;
</code></pre>
<p>其中，第一行替换成刚才注册的 Secret Key，然后保存退出。</p>
<h2><a id="%E5%AE%89%E8%A3%85mtproxy" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 MTProxy</h2>
<pre class="line-numbers"><code class="language-plain_text">$ docker run -d \
--name mtg \
-v /etc/mtg-config.toml:/config.toml \
-p 8443:3128 --restart=unless-stopped \
nineseconds/mtg:2
</code></pre>
<p>其中，第 4 行的 8443，是对外开放的端口 Port，可以自己修改。</p>
<p>最后，记得去防火墙放行 8443 端口。</p>
<p>至此，安装 MTProxy 完成。</p>
<h2><a id="%E4%BD%BF%E7%94%A8mtproxy" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用 MTProxy</h2>
<p>要丟给 Telegram 的链接可以套用以下规则：</p>
<pre class="line-numbers"><code class="language-plain_text">https://t.me/proxy?server=&lt;YOUR_IP&gt;&amp;port=&lt;PORT&gt;&amp;secret=&lt;SECRET&gt;
</code></pre>
<p>其中，<code>YOUR_IP</code> 为 VPS 公网 IP；<code>PORT</code> 跟 <code>SECRET</code> 就如上设定。</p>
<p>举例：</p>
<pre class="line-numbers"><code class="language-plain_text">https://t.me/proxy?server=101.101.101.101&amp;port=8443&amp;secret=ee9394946fae27cb52106f7923a27faa4c7a686968752e636f6d
</code></pre>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li><a href="https://github.com/9seconds/mtg">https://github.com/9seconds/mtg</a></li>
<li><a href="https://www.jkg.tw/p3526/">https://www.jkg.tw/p3526/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LibreWolf  浏览器配置]]></title>
    <link href="https://smartdigg.github.io/librewolf-browser-configuration.html"/>
    <updated>2024-11-10T23:42:15+08:00</updated>
    <id>https://smartdigg.github.io/librewolf-browser-configuration.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E8%A3%85">LibreWolf 浏览器安装</a></li>
<li><a href="#librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E7%BD%AE">LibreWolf 浏览器设置</a></li>
<li><a href="#librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AE%A1%E7%90%86">LibreWolf 浏览器管理</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85%E6%89%A9%E5%B1%95">安装扩展</a></li>
<li><a href="#%E6%9B%B4%E6%96%B0librewolf">更新 LibreWolf</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">添加搜索引擎</a></li>
<li><a href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98">其他问题</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>之前介绍过<a href="brave-browser-security-enhanced.html">Brave浏览器安全配置</a>，鉴于 Google 公司在 Chromium 项目中经常作妖，用户可以考虑使用 LibreWolf 浏览器。LibreWolf 浏览器是一款基于 Firefox 的浏览器，安全性与隐私性不弱于 Brave 浏览器。可参考<a href="https://privacytests.org/">privacytests.org</a>浏览器测评。</p>
<h2><a id="librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E8%A3%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>LibreWolf 浏览器安装</h2>
<pre class="line-numbers"><code class="language-plain_text">$ brew install --cask librewolf
</code></pre>
<p>由于 LibreWolf 浏览器开发者没有购买开发者证书，因此使用前需要在终端授权。</p>
<pre class="line-numbers"><code class="language-plain_text">$ xattr -cr /Applications/LibreWolf.app 
</code></pre>
<p>也可以一步到位安装：</p>
<pre class="line-numbers"><code class="language-plain_text">brew install librewolf --no-quarantine
</code></pre>
<h2><a id="librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>LibreWolf 浏览器设置</h2>
<p>LibreWolf 浏览器基本上与 Firefox 一致，唯独在设置中增加 LibreWolf 选项。</p>
<p><img src="media/17312533358317/Librewolf-setting.webp" alt="Librewolf-setting" /></p>
<p>LibreWolf 浏览器可以通过<code>about:config</code>来配置，另外也能通过修改配置文件<code>librewolf.overrides.cfg</code>来覆盖配置内容。</p>
<p><code>librewolf.overrides.cfg</code>配置文件默认不存在，如需使用需要手动创建：</p>
<pre class="line-numbers"><code class="language-plain_text">$ mkdir $HOME/.librewolf 
$ touch $HOME/.librewolf/librewolf.overrides.cfg
</code></pre>
<p>大致内容，按需修改：</p>
<pre class="line-numbers"><code class="language-plain_text">//Enable letterboxing
defaultPref(&quot;privacy.resistFingerprinting.letterboxing&quot;, true); 

//Limit cross-origin referers
defaultPref(&quot;network.http.referer.XOriginPolicy&quot;, 2);

//disable WebGL
defaultPref(&quot;webgl.disabled&quot;, true);
</code></pre>
<p>一些实用的设置：<br />
<code>about:config</code></p>
<pre class="line-numbers"><code class="language-plain_text">browser.search.openintab, true
browser.urlbar.openintab false
ui.prefersReducedMotion=0
</code></pre>
<h2><a id="librewolf%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>LibreWolf 浏览器管理</h2>
<h3><a id="%E5%AE%89%E8%A3%85%E6%89%A9%E5%B1%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装扩展</h3>
<p>官方建议尽可能少安装扩展，因为额外的扩展可能增加你的攻击面。</p>
<ul>
<li>uBlockOrigin <a href="https://github.com/gorhill/uBlock">https://github.com/gorhill/uBlock</a>；</li>
<li>Canvas Blocker <a href="https://addons.mozilla.org/en-US/firefox/addon/canvasblocker/">https://addons.mozilla.org/en-US/firefox/addon/canvasblocker</a>；<br />
其他拓展可参考<a href="network-security-manual.html">网络安全手册</a>。</li>
</ul>
<h3><a id="%E6%9B%B4%E6%96%B0librewolf" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>更新 LibreWolf</h3>
<pre class="line-numbers"><code class="language-plain_text">brew update &amp;&amp; brew upgrade
</code></pre>
<h3><a id="%E6%B7%BB%E5%8A%A0%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>添加搜索引擎</h3>
<p>LibreWolf 添加搜索引擎方式与 Firefox 相同：点击搜索框中的绿色加号，按指引操作即可。如果工具栏没有搜索框，可以右键点击工具栏，选择自定义工具栏，再将搜索栏拖放到需要的位置。</p>
<p><img src="media/17312533358317/x001.webp" alt="x001" /></p>
<p>部分搜索引擎不会弹出绿色加号，例如 Bing <a href="https://www2.bing.com">https://www2.bing.com</a>，可以进入设置手动添加。</p>
<p><img src="media/17312533358317/x003.webp" alt="x003" /></p>
<h3><a id="%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>其他问题</h3>
<ul>
<li>&quot;SSL_ERROR_UNSAFE_NEGOTIATION&quot;：修改<code>security.ssl.require_safe_negotiation</code> 为<code>false</code>；</li>
<li>&quot;SEC_ERROR_OCSP_SERVER_ERROR&quot;：在设置LibreWolf首选项中取消勾选<code>Enforce OCSP hard-fail</code>。</li>
</ul>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>Privacy-settings <a href="https://github.com/StellarSand/privacy-settings">https://github.com/StellarSand/privacy-settings</a></li>
<li>LibreWolf浏览器官网 <a href="https://librewolf.net/">https://librewolf.net</a></li>
<li>干净简洁的浏览器，LibreWolf软件体验  <a href="https://post.smzdm.com/p/ag5d8e9w/">https://post.smzdm.com/p/ag5d8e9w</a></li>
<li>纠结了很久 Chrome 和 Arc，最终选择了 Librewolf <a href="https://sspai.com/post/85096">https://sspai.com/post/85096</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS 配置 Homebrew]]></title>
    <link href="https://smartdigg.github.io/macos-configure-homebrew.html"/>
    <updated>2024-10-23T13:25:03+08:00</updated>
    <id>https://smartdigg.github.io/macos-configure-homebrew.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85commandlinetools">重新安装 CommandLineTools</a></li>
<li><a href="#%E5%AE%89%E8%A3%85homebrew">安装 Homebrew</a></li>
<li><a href="#homebrew%E4%BD%BF%E7%94%A8">Homebrew 使用</a></li>
<li><a href="#%E6%81%A2%E5%A4%8Dhomebrew%E9%BB%98%E8%AE%A4%E6%BA%90">恢复 Homebrew 默认源</a></li>
<li><a href="#%E5%88%A0%E9%99%A4homebrew">删除 Homebrew</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>本篇适用于 macOS 重装或降级后使用 Homebrew，部分内容也适用于全新系统安装 Homebrew。</p>
<p>macOS 重装或降级后，若使用 Time Machine 恢复，一般情况下 Homebrew 不能正常工作。这时就需重新配置 Homebrew。</p>
<h2><a id="%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85commandlinetools" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>重新安装 CommandLineTools</h2>
<p>重置<code>CommandLineTools</code>：</p>
<pre class="line-numbers"><code class="language-zsh">$ sudo xcode-select --reset
</code></pre>
<p>然后删除旧的<code>CommandLineTools</code>：</p>
<pre class="line-numbers"><code class="language-zsh">$ sudo rm -rf /Library/Developer/CommandLineTools
</code></pre>
<p>全新安装<code>CommandLineTools</code>：</p>
<pre class="line-numbers"><code class="language-zsh">$ sudo xcode-select --install
</code></pre>
<p>全新安装 Homebrew，仅需执行最后一步。</p>
<h2><a id="%E5%AE%89%E8%A3%85homebrew" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 Homebrew</h2>
<p>以下设置适用于 Apple Silicon CPU 设备，即带 M 芯片，默认使用<code>zsh</code>。鉴于大陆 Github 使用困难，本篇使用清华软件源。</p>
<ol>
<li>设置 Homebrew 环境变量：</li>
</ol>
<pre class="line-numbers"><code class="language-zsh">$ export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;
$ export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;
$ export HOMEBREW_INSTALL_FROM_API=1
</code></pre>
<ol start="2">
<li>配置 Homebrew Bottles 环境变量：</li>
</ol>
<pre class="line-numbers"><code class="language-zsh">$ echo 'export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;' &gt;&gt; ~/.zprofile
$ echo 'export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;' &gt;&gt; ~/.zprofile
$ export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;
$ export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;
</code></pre>
<ol start="3">
<li>（可选）配置 Homebrew PyPi 环境变量：</li>
</ol>
<pre class="line-numbers"><code class="language-zsh">$ export HOMEBREW_PIP_INDEX_URL=&quot;https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple&quot;
</code></pre>
<ol start="4">
<li>安装 Homebrew：</li>
</ol>
<pre class="line-numbers"><code class="language-zsh">$ git clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install
$ cd brew-install &amp;&amp; sudo ./install.sh
$ rm -rf brew-install
</code></pre>
<ol start="5">
<li>将<code>brew</code>程序的相关路径加入到环境变量中：</li>
</ol>
<pre class="line-numbers"><code class="language-zsh">$ test -r ~/.zprofile &amp;&amp; echo 'eval &quot;$(/opt/homebrew/bin/brew shellenv)&quot;' &gt;&gt; ~/.zprofile
$ export HOMEBREW_NO_ANALYTICS=1
</code></pre>
<h2><a id="homebrew%E4%BD%BF%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Homebrew 使用</h2>
<p>安装软件，例如<a href="librewolf-browser-configuration.html">LibreWolf浏览器</a></p>
<pre class="line-numbers"><code class="language-zsh">$ brew install --cask librewolf
</code></pre>
<p>升级软件包</p>
<pre class="line-numbers"><code class="language-zsh">brew upgrade ***
</code></pre>
<p>卸载软件</p>
<pre class="line-numbers"><code class="language-zsh">$ brew uninstall ***
</code></pre>
<p>更新 Homebrew 自身</p>
<pre class="line-numbers"><code class="language-zsh">$ brew update 
</code></pre>
<p>更新所有 cask 软件</p>
<pre class="line-numbers"><code class="language-zsh">$ brew upgrade --cask $(brew list --cask)
</code></pre>
<h2><a id="%E6%81%A2%E5%A4%8Dhomebrew%E9%BB%98%E8%AE%A4%E6%BA%90" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>恢复 Homebrew 默认源</h2>
<p>参考清华帮助文档细节。</p>
<pre class="line-numbers"><code class="language-zsh"># brew 程序本身，Homebrew / Linuxbrew 相同
unset HOMEBREW_API_DOMAIN
unset HOMEBREW_BREW_GIT_REMOTE
git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew

# 以下针对 macOS 系统上的 Homebrew
unset HOMEBREW_CORE_GIT_REMOTE
BREW_TAPS=&quot;$(BREW_TAPS=&quot;$(brew tap 2&gt;/dev/null)&quot;; echo -n &quot;${BREW_TAPS//$'\n'/:}&quot;)&quot;
for tap in core cask command-not-found; do
    if [[ &quot;:${BREW_TAPS}:&quot; == *&quot;:homebrew/${tap}:&quot;* ]]; then  # 只复原已安装的 Tap
        brew tap --custom-remote &quot;homebrew/${tap}&quot; &quot;https://github.com/Homebrew/homebrew-${tap}&quot;
    fi
done

# 重新拉取远程
brew update
</code></pre>
<p>同时检查<code>~/.zprofile</code>内容，删除带有<code>mirrors.tuna.tsinghua.edu.cn</code>的行。</p>
<h2><a id="%E5%88%A0%E9%99%A4homebrew" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>删除 Homebrew</h2>
<pre class="line-numbers"><code class="language-plain_text">$ /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)&quot;
</code></pre>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>Homebrew 官方安装文档 <a href="https://docs.brew.sh/Installation">https://docs.brew.sh/Installation</a></li>
<li>Homebrew更换国内镜像源 <a href="https://www.cnblogs.com/Flat-White/p/19008881">https://www.cnblogs.com/Flat-White/p/19008881</a></li>
<li>清华 Homebrew 软件仓库配置 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[超简单个人网页 TiddlyWiki]]></title>
    <link href="https://smartdigg.github.io/super-simple-personal-webpage-tiddlywiki.html"/>
    <updated>2024-09-13T14:35:05+08:00</updated>
    <id>https://smartdigg.github.io/super-simple-personal-webpage-tiddlywiki.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E4%B8%8B%E8%BD%BDtiddlywiki">下载 TiddlyWiKi</a></li>
<li><a href="#%E7%BC%96%E8%BE%91%E5%92%8C%E4%BF%9D%E5%AD%98">编辑和保存</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6">安装插件</a></li>
<li><a href="#%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87">插入图片</a>
<ul>
<li><a href="#%E7%BD%91%E9%A1%B5%E5%9B%BE%E7%89%87">网页图片</a></li>
<li><a href="#%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">本地图片</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%BD%AF%E4%BB%B6%E6%9B%B4%E6%96%B0">软件更新</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E4%B8%AA%E4%BA%BA%E7%BD%91%E9%A1%B5">配置个人网页</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>TiddlyWiki 是一款很强大的个人知识管理系统，也可作为个人网页使用。好处是单文件、易备份、跨平台、上手难度低。</p>
<h2><a id="%E4%B8%8B%E8%BD%BDtiddlywiki" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>下载 TiddlyWiKi</h2>
<p>打开 TiddlyWiki 官网<a href="https://tiddlywiki.com/">https://tiddlywiki.com</a>，在 GettingStarted 部分下载空白副本，默认文件名为<code>empty.html</code>。</p>
<p>也可以选择下载 TiddlyWiKi 经典版本<a href="https://classic.tiddlywiki.com/">https://classic.tiddlywiki.com/</a>。</p>
<p>主要区别：经典 TiddlyWiKi 有多年历史，而新版 TiddlyWiKi 使用html5，外观更现代化。两个版本都在更新。</p>
<p>本文所介绍的是新版 TiddlyWiKi，又称 TiddlyWiKi 5。</p>
<h2><a id="%E7%BC%96%E8%BE%91%E5%92%8C%E4%BF%9D%E5%AD%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>编辑和保存</h2>
<p>TiddlyWiKi 作为单一 html 文件可直接通过浏览器打开、编辑与保存。也可使用如 TiddlyDesktop 等软件自动保存。在 GettingStarted 部分也有其他软件推荐。</p>
<p>TiddlyDesktop 需从 Github 下载安装<a href="https://github.com/TiddlyWiki/TiddlyDesktop/releases">https://github.com/TiddlyWiki/TiddlyDesktop/releases</a>。</p>
<p>打开 TiddlyDesktop，将<code>empty.html</code>文件拖入其中。TiddlyDesktop 主界面有<code>advanced</code>选项，可选择是否启用自动备份。</p>
<h3><a id="%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装插件</h3>
<p>可选择安装 Markdown、Relink、Highlighter 等插件。TiddlyWiKi 原生不支持 Markdown 编辑，但可通过 Markdown 插件实现。</p>
<p>在设置中选择<code>Appearance</code>&gt;<code>Toolbars</code>&gt;<code>Page Toolbar</code>中勾选<code>new Markdown tiddler</code>，以后只需点击右侧图标便可添加 Markdown 笔记。</p>
<h3><a id="%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>插入图片</h3>
<p>TiddlyWiKi 支持直接拖入图片，但这样一来会使得 WiKi 文件变得很大，相比而言，插入图片链接可节省很多空间。</p>
<h4><a id="%E7%BD%91%E9%A1%B5%E5%9B%BE%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>网页图片</h4>
<p>在 Markdown 模式中，插入网页图片：</p>
<pre class="line-numbers"><code class="language-plain_text">[img[https://i-blog.csdnimg.cn/blog_migrate/0b28e73406e0a641959929c1d1ffe32f.jpeg]]
</code></pre>
<h4><a id="%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>本地图片</h4>
<p>在<code>empty.html</code>所在文件夹下新建文件夹<code>images</code>，将需要插入的图片放置到该文件夹下。</p>
<p>在 Markdown 模式中，插入本地图片：</p>
<pre class="line-numbers"><code class="language-plain_text">[img[./images/image-name.jpg]]
</code></pre>
<h2><a id="%E8%BD%AF%E4%BB%B6%E6%9B%B4%E6%96%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>软件更新</h2>
<p>打开更新网页<a href="https://tiddlywiki.com/upgrade.html">https://tiddlywiki.com/upgrade.html</a>，将自己的 WiKi 文件拖入，按照提示操作。</p>
<h2><a id="%E9%85%8D%E7%BD%AE%E4%B8%AA%E4%BA%BA%E7%BD%91%E9%A1%B5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置个人网页</h2>
<p>参考<a href="how-to-quickly-build-a-personal-static-blog.html">如何快速搭建个人静态博客</a>，配置喜欢的域名，再利用 GithubDesktop 上传即可。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>TiddlyWiKi <a href="https://tiddlywiki.com/">https://tiddlywiki.com</a></li>
<li>TiddlyWiKi Classic <a href="https://classic.tiddlywiki.com/">https://classic.tiddlywiki.com</a></li>
<li>Classic TiddlyThemes <a href="https://github.com/YakovL/TiddlyThemes">https://github.com/YakovL/TiddlyThemes</a></li>
<li>TiddyWiki 简易指南 <a href="https://pkmer.cn/Pkmer-Docs/12-tiddywiki/tiddywiki/">https://pkmer.cn/Pkmer-Docs/12-tiddywiki/tiddywiki</a></li>
<li>探索 TiddlyWiki 5：个人知识管理的利器 <a href="https://blog.csdn.net/gitblog_00041/article/details/136706046">https://blog.csdn.net/gitblog_00041/article/details/136706046</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[网络搜索引擎]]></title>
    <link href="https://smartdigg.github.io/search-engine.html"/>
    <updated>2023-11-22T01:38:16+08:00</updated>
    <id>https://smartdigg.github.io/search-engine.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%95%86%E7%94%A8%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E9%97%AE%E9%A2%98">商用搜索引擎问题</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8E%A8%E8%8D%90">安全搜索引擎推荐</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">添加搜索引擎</a>
<ul>
<li><a href="#%E5%9F%BA%E4%BA%8Echromium%E6%B5%8F%E8%A7%88%E5%99%A8">基于 Chromium 浏览器</a></li>
<li><a href="#firefox">Firefox</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<h2><a id="%E5%95%86%E7%94%A8%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>商用搜索引擎问题</h2>
<p>商用搜索引擎通常收集、存储和分享有关用户搜索和浏览习惯的数据，包括但不限于搜索查询、IP地址、内容过滤、第三方Trackers等等。</p>
<p><strong>远离百度、搜狗、360搜索、Bing、Google等搜索引擎</strong>。</p>
<h2><a id="%E5%AE%89%E5%85%A8%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8E%A8%E8%8D%90" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安全搜索引擎推荐</h2>
<ul>
<li><a href="https://search.brave.com/">Brave search</a></li>
<li><a href="https://search.disroot.org/">Disroot</a></li>
<li><a href="https://duckduckgo.com/">Duckduckgo</a></li>
<li><a href="https://gibiru.com/">Gibiru</a></li>
<li><a href="https://metager.org/">Metager</a></li>
<li><a href="https://www.startpage.com/">Mojeek</a></li>
<li><a href="https://www.qwant.com/">Qwant</a></li>
<li><a href="https://searx.space/">SearX</a>（可自建）</li>
<li><a href="https://www.startpage.com/">Startpage</a></li>
<li><a href="https://github.com/benbusby/whoogle-search">Whoogle</a>（可自建）</li>
<li>其他搜索引擎及比较：<a href="https://searchengine.party">https://searchengine.party</a></li>
</ul>
<h2><a id="%E6%B7%BB%E5%8A%A0%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>添加搜索引擎</h2>
<h3><a id="%E5%9F%BA%E4%BA%8Echromium%E6%B5%8F%E8%A7%88%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>基于 Chromium 浏览器</h3>
<p>以Brave浏览器为例，参考<a href="brave-browser-security-enhanced.html">Brave浏览器安全配置</a>。<br />
从设置的侧边栏进入Search engine，在Manage search engines and site search页面下方Site search添加，</p>
<p>例如添加Brave搜索引擎：</p>
<pre class="line-numbers"><code class="language-plain_text">Name：Brave
Shortcut：
URL with %s in place of query：https://search.brave.com/search?q=%s
</code></pre>
<h3><a id="firefox" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Firefox</h3>
<p>首先在设置中将搜索框加入工具栏：<code>Add search bar in toolbar</code>。之后打开搜索引擎首页便会在搜索框出现添加提示。</p>
<p>部分搜索引擎不会出现提示，可到设置中手动添加，也可以安装插件<code>Add custom search engine</code>。 打开插件首选项，按照插件提示类似填写即可。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>privacytools <a href="https://www.privacytools.io/private-search">https://www.privacytools.io/private-search</a></li>
<li>prism-break <a href="https://prism-break.org/en/categories/gnu-linux/#web-search">https://prism-break.org/en/categories/gnu-linux/#web-search</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Brave 浏览器安全配置]]></title>
    <link href="https://smartdigg.github.io/brave-browser-security-enhanced.html"/>
    <updated>2023-11-05T17:24:33+08:00</updated>
    <id>https://smartdigg.github.io/brave-browser-security-enhanced.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E8%A3%85brave%E6%B5%8F%E8%A7%88%E5%99%A8">安装Brave浏览器</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA">设置安全增强</a>
<ul>
<li><a href="#shields">Shields</a></li>
<li><a href="#privacy-and-security">Privacy and security</a></li>
<li><a href="#search-engine">Search engine</a></li>
<li><a href="#extensions">Extensions</a></li>
</ul>
</li>
<li><a href="#%E6%8F%92%E4%BB%B6">插件</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>Brave 浏览器是一款关注隐私和安全的开源浏览器，提供简洁的安全配置。从<a href="https://privacytests.org/">PrivacyTests.org</a>可以看出Brave浏览器在日常使用中可以提供相当好的保护。</p>
<h2><a id="%E5%AE%89%E8%A3%85brave%E6%B5%8F%E8%A7%88%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装Brave浏览器</h2>
<p>从 Brave 浏览器主页下载：<a href="https://brave.com/">https://brave.com</a>。</p>
<p>也可以到 Github Brave 页面下载：<a href="https://github.com/brave/brave-browser">https://github.com/brave/brave-browser</a>。</p>
<p>以下设置仅提供日常网络安全保护（网址加密、阻止广告、跟踪、指纹等），并不代表上网匿名。<br />
通过一些网站如<a href="https://browserleaks.com/">https://browserleaks.com</a>或<a href="https://coveryourtracks.eff.org/">https://coveryourtracks.eff.org</a>等可以轻易看到你的IP地址以及浏览器信息。</p>
<p>追求更高安全的匿名可使用虚拟机+VPN+TOR浏览器。</p>
<h2><a id="%E8%AE%BE%E7%BD%AE%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>设置安全增强</h2>
<p>安装 Brave 浏览器后，从右上角进入设置（Settings）。</p>
<h3><a id="shields" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Shields</h3>
<ul>
<li><code>Trackers &amp; ads blocking</code>：选择<code>Standard</code>；</li>
<li><code>Upgrade connections to HTTPS</code>：选择<code>Strict</code>；</li>
<li><code>Block fingerprinting</code>：选择<code>Standard</code>；</li>
<li><code>Block cookies</code>：选择<code>Only cross-site</code>；</li>
<li><code>Content filtering</code>：根据需要开启过滤；</li>
<li><code>Auto-redirect tracking URLs</code>：开启；</li>
<li><code>Prevent sites from fingerprinting me based on my language preferences</code>：开启；</li>
<li><code>Content Filters</code>：</li>
</ul>
<p>附一些常用的规则：</p>
<ul>
<li>HalfLife，规则合并自 EasylistChina、EasylistLite、CJX’sAnnoyance 合并规则：<a href="https://gitee.com/halflife/list/raw/master/ad.txt">https://gitee.com/halflife/list/raw/master/ad.txt</a></li>
<li>EasyPrivacy，隐私保护：<a href="https://easylist-downloads.adblockplus.org/easyprivacy.txt">https://easylist-downloads.adblockplus.org/easyprivacy.txt</a></li>
<li>I don’t care about cookies，我不关心 Cookie 的问题，屏蔽网站的 cookies 相关的警告：<a href="https://www.i-dont-care-about-cookies.eu/abp/">https://www.i-dont-care-about-cookies.eu/abp/</a></li>
<li>anti-AD，自称是目前中文区命中率最高的广告过滤列表：<a href="https://gitee.com/privacy-protection-tools/anti-ad/raw/master/easylist.txt">https://gitee.com/privacy-protection-tools/anti-ad/raw/master/easylist.txt</a></li>
<li>乘风广告、视频过滤规则：<a href="https://gitee.com/xinggsf/Adblock-Rule/raw/master/rule.txt%E3%80%81https://gitee.com/xinggsf/Adblock-Rule/raw/master/mv.txt">https://gitee.com/xinggsf/Adblock-Rule/raw/master/rule.txt、https://gitee.com/xinggsf/Adblock-Rule/raw/master/mv.txt</a></li>
</ul>
<p><strong>Social media blocking</strong>，关闭所有。</p>
<h3><a id="privacy-and-security" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Privacy and security</h3>
<ul>
<li><code>WebRTC IP Handling Policy</code>：选择<code>Disable non-proxied UDP</code>；也可以安装扩展<code>WebRTC Leak Shield</code>来限制WebRTC；</li>
<li><code>Use Google services for push messaging</code>：关闭；</li>
<li><code>Allow privacy-preserving product analytics (P3A)</code>：关闭；</li>
<li><code>Automatically send diagnostic reports</code>：关闭；</li>
<li><code>Automatically send daily usage ping to Brave</code>：关闭。</li>
</ul>
<h3><a id="search-engine" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Search engine</h3>
<ul>
<li><code>Improve search suggestions</code>：关闭；</li>
<li><code>Web Discovery Project</code>：关闭；</li>
<li><code>Index other search engines</code>：关闭。</li>
</ul>
<h3><a id="extensions" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extensions</h3>
<p>不使用可以关闭：<code>Hangouts</code>、<code>Media Router</code>、<code>WebTorrent</code>、<code>Widevine</code>。</p>
<h2><a id="%E6%8F%92%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>插件</h2>
<ul>
<li>uBlock Origin；</li>
<li>Privacy Badger；</li>
<li>Decentraleyes；</li>
<li>Cookie AutoDelete；</li>
<li>Tampermonkey（可选）；</li>
<li>WebRTC Leak Shield（可选）。</li>
</ul>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>brave browser <a href="https://brave.com/">https://brave.com</a></li>
<li>browserleaks <a href="https://browserleaks.com/">https://browserleaks.com</a></li>
<li>privacytools <a href="https://www.privacytools.io/">https://www.privacytools.io</a></li>
<li>privacy-settings <a href="https://github.com/StellarSand/privacy-settings">https://github.com/StellarSand/privacy-settings</a></li>
<li>coveryourtracks <a href="https://coveryourtracks.eff.org/">https://coveryourtracks.eff.org</a></li>
<li>privacytests <a href="https://privacytests.org/news.html">https://privacytests.org/news.html</a></li>
<li>privacyguides <a href="https://www.privacyguides.org/en/desktop-browsers/#brave">https://www.privacyguides.org/en/desktop-browsers/#brave</a></li>
<li>使用Docker自建支持DoH、DoT的DNS服务器 <a href="https://morooi.com/2020/%E6%90%AD%E5%BB%BADNS%E6%9C%8D%E5%8A%A1%E5%99%A8/">https://morooi.com/2020/%E6%90%AD%E5%BB%BADNS%E6%9C%8D%E5%8A%A1%E5%99%A8/<br />
</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[安全、隐私和匿名]]></title>
    <link href="https://smartdigg.github.io/security-privacy-anonymity.html"/>
    <updated>2023-11-04T09:58:41+08:00</updated>
    <id>https://smartdigg.github.io/security-privacy-anonymity.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%89%E5%85%A8%E3%80%81%E9%9A%90%E7%A7%81%E5%92%8C%E5%8C%BF%E5%90%8D%E7%9A%84%E5%85%B3%E7%B3%BB">安全、隐私和匿名的关系</a>
<ul>
<li><a href="#%E6%B2%A1%E6%9C%89%E9%9A%90%E7%A7%81%E6%88%96%E5%8C%BF%E5%90%8D%E7%9A%84%E5%AE%89%E5%85%A8">没有隐私或匿名的安全</a></li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E7%9A%84%E9%9A%90%E7%A7%81">没有匿名的隐私</a></li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%AE%89%E5%85%A8%E7%9A%84%E5%8C%BF%E5%90%8D">没有安全的匿名</a></li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E7%9A%84%E5%AE%89%E5%85%A8%E5%92%8C%E9%9A%90%E7%A7%81">没有匿名的安全和隐私</a></li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E6%88%96%E5%AE%89%E5%85%A8%E7%9A%84%E9%9A%90%E7%A7%81">没有匿名或安全的隐私</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
</ul>
</div>
<p>我们可能认为我们知道隐私、安全和匿名之间的区别，但我们经常混淆它们，它们绝对不是同一件事。</p>
<p>简单理解安全、隐私和匿名：</p>
<ul>
<li>安全（Security）：防止未经授权的人接触到信息、账户或其他类似东西；</li>
<li>隐私（Privacy）：涉及你的身份和信息，不希望别人知道的。比如三围、聊天记录、银行卡密码等；</li>
<li>匿名（Anonymity）：隐藏你的真实身份，完全不为任何人所知。</li>
</ul>
<h2><a id="%E5%AE%89%E5%85%A8%E3%80%81%E9%9A%90%E7%A7%81%E5%92%8C%E5%8C%BF%E5%90%8D%E7%9A%84%E5%85%B3%E7%B3%BB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安全、隐私和匿名的关系</h2>
<p>隐私有助于你的安全，因为如果别人不知道你的信息，他们就无法冒充你来回答安全问题。安全可以通过控制谁能获取你的信息来保护你的隐私。<br />
以家庭住房为例：安全是门锁；隐私是钥匙，你可以决定谁能得到备用钥匙；匿名是指没有人获得备用钥匙，甚至是家庭地址。</p>
<p>这三个概念不一定相互依赖。安全产品不能保证隐私，私有产品不能保证安全，匿名也不能保证。</p>
<h3><a id="%E6%B2%A1%E6%9C%89%E9%9A%90%E7%A7%81%E6%88%96%E5%8C%BF%E5%90%8D%E7%9A%84%E5%AE%89%E5%85%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>没有隐私或匿名的安全</h3>
<p>谷歌提供了世界一流的安全性，却没有隐私或匿名。</p>
<h3><a id="%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E7%9A%84%E9%9A%90%E7%A7%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>没有匿名的隐私</h3>
<p>类似<a href="privacy.com">Privacy.com</a>、<a href="https://ironvest.com/">IronVest</a>（曾经的 Blur）提供的掩码卡(Masked card)服务，他们清楚地知道你是谁。不过，他们会向你提供虚拟电话号码、电子邮件地址和银行卡，让你提供给其他公司和个人，从而保护你的真实信息，帮助你保护自己的隐私。</p>
<h3><a id="%E6%B2%A1%E6%9C%89%E5%AE%89%E5%85%A8%E7%9A%84%E5%8C%BF%E5%90%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>没有安全的匿名</h3>
<p>以现金为例，以现金支付商品可以保持您的匿名。但是，如果卖家不发货（除非您有收据），您就没有任何安全保障。</p>
<h3><a id="%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E7%9A%84%E5%AE%89%E5%85%A8%E5%92%8C%E9%9A%90%E7%A7%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>没有匿名的安全和隐私</h3>
<p>以 Signal 为例，Signal 注册需要您的电话号码，因此可以通过法院命令甚至网络搜索来找到您的身份，具体取决于您使用的电话号码。即使您的身份不受保护和控制，您的 Signal 消息内容和您传输的信息也将受到保护和控制。</p>
<h3><a id="%E6%B2%A1%E6%9C%89%E5%8C%BF%E5%90%8D%E6%88%96%E5%AE%89%E5%85%A8%E7%9A%84%E9%9A%90%E7%A7%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>没有匿名或安全的隐私</h3>
<p>想想你在野外上厕所的情景。你可以找一些小树丛躲在后面，这样可以保护你的隐私，但却没有安全性或匿名性。没有任何东西可以阻止任何人找到你，如果警察要求你出示证件，你也得不到任何保护。</p>
<h2><a id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考资料</h2>
<ul>
<li>privacyguides <a href="https://blog.privacyguides.org/2021/02/23/security-privacy-anonymity/">https://blog.privacyguides.org/2021/02/23/security-privacy-anonymity/</a></li>
<li>web.archive <a href="https://web.archive.org/web/20210729190914/https://thenewoil.xyz/privsecanon.html">https://web.archive.org/web/20210729190914/https://thenewoil.xyz/privsecanon.html</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
